-- phpMyAdmin SQL Dump
-- version 4.5.2
-- http://www.phpmyadmin.net
--
-- Host: localhost
-- Generation Time: 2017-02-09 18:21:35
-- 服务器版本： 10.1.10-MariaDB
-- PHP Version: 7.0.2

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `dspider`
--

-- --------------------------------------------------------

--
-- 表的结构 `app_keys`
--

CREATE TABLE `app_keys` (
  `id` int(10) UNSIGNED NOT NULL,
  `user_id` int(10) UNSIGNED NOT NULL,
  `secret` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `name` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `package` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `state` tinyint(4) NOT NULL DEFAULT '1',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

--
-- 转存表中的数据 `app_keys`
--

INSERT INTO `app_keys` (`id`, `user_id`, `secret`, `name`, `package`, `state`, `created_at`, `updated_at`) VALUES
(1, 1, '25XBLR8vTFUHJPNz6LDMEe9r4tro683z', '小赢卡带', 'wendu.spider', 1, '2016-12-11 22:56:40', '2017-01-14 21:42:36'),
(4, 1, 'FiLGgJGMiC3S8VSGjgYA9Ok9KtomRxrW', '小赢理财', 'com.licai.xiaoying', 1, '2016-12-19 23:20:19', '2016-12-19 23:20:19');

-- --------------------------------------------------------

--
-- 表的结构 `crawl_records`
--

CREATE TABLE `crawl_records` (
  `id` int(10) UNSIGNED NOT NULL,
  `appKey_id` int(10) UNSIGNED NOT NULL,
  `spider_id` int(10) UNSIGNED NOT NULL,
  `script_id` int(10) UNSIGNED NOT NULL DEFAULT '0',
  `config` text COLLATE utf8_unicode_ci,
  `state` tinyint(4) NOT NULL DEFAULT '-1',
  `msg` mediumtext COLLATE utf8_unicode_ci,
  `app_version` varchar(20) COLLATE utf8_unicode_ci DEFAULT NULL,
  `sdk_version` varchar(20) COLLATE utf8_unicode_ci DEFAULT NULL,
  `os_type` tinyint(4) NOT NULL,
  `device_id` int(10) UNSIGNED NOT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

--
-- 转存表中的数据 `crawl_records`
--

INSERT INTO `crawl_records` (`id`, `appKey_id`, `spider_id`, `script_id`, `config`, `state`, `msg`, `app_version`, `sdk_version`, `os_type`, `device_id`, `created_at`, `updated_at`) VALUES
(2, 1, 8, 6, NULL, 2, '{"url":"https://www.baidu.com/","msg":"Cannot set property ''trigger_'' of undefined","args":{"wd":"杜文"},"stack":"语法错误: Cannot set property ''trigger_'' of undefined\\nscript_url:http://172.19.23.62/dSpider-web/1.0/script\\nTypeError: Cannot set property ''trigger_'' of undefined\\n    at https://www.baidu.com/dspider/spider?t=1486543270871:335:18\\n    at https://www.baidu.com/dspider/spider?t=1486543270871:181:9\\n    at HTMLDocument.<anonymous> (https://www.baidu.com/dspider/spider?t=1486543270871:169:9)\\n    at HTMLDocument.<anonymous> (https://www.baidu.com/dspider/spider?t=1486543270871:61:15)\\n    at j (https://www.baidu.com/dspider/dQuery:2:30000)\\n    at k (https://www.baidu.com/dspider/dQuery:2:30314)"}', '1.0', '1.0.0', 1, 5, '2017-02-08 00:41:07', '2017-02-08 00:41:29'),
(3, 1, 8, 6, NULL, 2, '{"url":"http://mail.sina.cn/?vt=4","msg":"Cannot set property ''trigger_'' of undefined","args":{"wd":"杜文"},"stack":"语法错误: Cannot set property ''trigger_'' of undefined\\nscript_url:http://172.19.23.62/dSpider-web/1.0/script\\nTypeError: Cannot set property ''trigger_'' of undefined\\n    at http://mail.sina.cn/dspider/spider?t=1486543489998:335:18\\n    at http://mail.sina.cn/dspider/spider?t=1486543489998:181:9\\n    at HTMLDocument.<anonymous> (http://mail.sina.cn/dspider/spider?t=1486543489998:169:9)\\n    at HTMLDocument.<anonymous> (http://mail.sina.cn/dspider/spider?t=1486543489998:61:15)\\n    at j (http://mail.sina.cn/dspider/dQuery:2:30000)\\n    at k (http://mail.sina.cn/dspider/dQuery:2:30314)"}', '1.0', '1.0.0', 1, 5, '2017-02-08 00:44:45', '2017-02-08 00:44:57'),
(4, 1, 8, 6, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-08 00:46:59', '2017-02-08 00:47:44'),
(5, 1, 8, 6, NULL, -2, NULL, '1.0', '1.0.0', 1, 5, '2017-02-08 00:48:16', '2017-02-08 00:48:16'),
(6, 1, 8, 6, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-08 00:50:02', '2017-02-08 00:50:27'),
(7, 1, 8, 6, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-08 00:50:40', '2017-02-08 00:52:14'),
(8, 1, 8, 6, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-08 00:52:38', '2017-02-08 00:52:52'),
(9, 1, 12, 16, NULL, -2, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 00:50:10', '2017-02-09 00:50:10'),
(10, 1, 12, 16, NULL, -2, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 00:51:03', '2017-02-09 00:51:03'),
(11, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:19:21', '2017-02-09 01:19:43'),
(12, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:21:16', '2017-02-09 01:21:39'),
(13, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:33:41', '2017-02-09 01:34:04'),
(14, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:36:28', '2017-02-09 01:36:46'),
(15, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:42:32', '2017-02-09 01:43:41'),
(16, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:46:24', '2017-02-09 01:46:37'),
(17, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:52:38', '2017-02-09 01:52:47'),
(18, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:53:19', '2017-02-09 01:53:27'),
(19, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:54:45', '2017-02-09 01:55:15'),
(20, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:57:07', '2017-02-09 01:57:19'),
(21, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 01:59:18', '2017-02-09 01:59:35'),
(22, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 02:00:21', '2017-02-09 02:00:31'),
(23, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 02:05:33', '2017-02-09 02:05:42'),
(24, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 02:07:15', '2017-02-09 02:07:27'),
(25, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 02:08:16', '2017-02-09 02:09:18'),
(26, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 02:10:24', '2017-02-09 02:10:33'),
(27, 1, 12, 16, NULL, 0, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 02:12:07', '2017-02-09 02:16:05'),
(28, 1, 12, 16, NULL, -2, NULL, '1.0', '1.0.0', 1, 5, '2017-02-09 02:18:21', '2017-02-09 02:18:21');

-- --------------------------------------------------------

--
-- 表的结构 `devices`
--

CREATE TABLE `devices` (
  `id` int(10) UNSIGNED NOT NULL,
  `identifier` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `os_type` tinyint(4) NOT NULL,
  `os_version` varchar(20) COLLATE utf8_unicode_ci NOT NULL,
  `model` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

--
-- 转存表中的数据 `devices`
--

INSERT INTO `devices` (`id`, `identifier`, `os_type`, `os_version`, `model`, `created_at`, `updated_at`) VALUES
(5, '860076039858476', 1, '6.0', 'HUAWEI NXT-AL10', '2017-02-07 23:30:05', '2017-02-07 23:30:05');

-- --------------------------------------------------------

--
-- 表的结构 `downloads`
--

CREATE TABLE `downloads` (
  `id` int(10) UNSIGNED NOT NULL,
  `count` int(11) NOT NULL DEFAULT '0',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

--
-- 转存表中的数据 `downloads`
--

INSERT INTO `downloads` (`id`, `count`, `created_at`, `updated_at`) VALUES
(1, 1, '2017-01-07 22:20:40', '2017-01-07 22:20:40'),
(2, 3, '2017-01-07 22:16:26', '2017-01-07 22:20:35');

-- --------------------------------------------------------

--
-- 表的结构 `migrations`
--

CREATE TABLE `migrations` (
  `id` int(10) UNSIGNED NOT NULL,
  `migration` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `batch` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

--
-- 转存表中的数据 `migrations`
--

INSERT INTO `migrations` (`id`, `migration`, `batch`) VALUES
(1, '2014_10_12_000000_create_users_table', 1),
(2, '2014_10_12_100000_create_password_resets_table', 1),
(3, '2016_12_01_021056_create_spiders_table', 1),
(4, '2016_12_01_093404_create_app_keys_table', 1),
(5, '2016_12_02_063620_create_spider_configs_table', 1),
(6, '2016_12_07_031352_create_devices_table', 1),
(7, '2016_12_12_055152_create_crawl_records_table', 1),
(8, '2017_01_08_060256_create_downloads_table', 2),
(9, '2017_01_23_015316_create_scripts_table', 3);

-- --------------------------------------------------------

--
-- 表的结构 `password_resets`
--

CREATE TABLE `password_resets` (
  `email` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `token` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `created_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- 表的结构 `scripts`
--

CREATE TABLE `scripts` (
  `id` int(10) UNSIGNED NOT NULL,
  `spider_id` int(10) UNSIGNED NOT NULL DEFAULT '0',
  `callCount` int(10) UNSIGNED NOT NULL DEFAULT '0',
  `online` tinyint(4) NOT NULL DEFAULT '0',
  `min_sdk` varchar(15) COLLATE utf8_unicode_ci NOT NULL DEFAULT '1.0.0',
  `content` text COLLATE utf8_unicode_ci,
  `priority` smallint(6) NOT NULL DEFAULT '0',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

--
-- 转存表中的数据 `scripts`
--

INSERT INTO `scripts` (`id`, `spider_id`, `callCount`, `online`, `min_sdk`, `content`, `priority`, `created_at`, `updated_at`) VALUES
(1, 1, 0, 1, '1.0.0', '/**\n * Created by du on 16/11/21.\n */\ndSpider("test", function(session,env,$){\n    var count=100;\n    session.showProgress();\n    session.setProgressMsg("正在初始化");\n    var timer=setInterval(function(){\n      var cur=100-(--count);\n      session.setProgress(cur);\n      session.setProgressMsg("正在爬取第"+cur+"条记录");\n      session.upload({title:"数据"+cur, data:"hi, I am data "+cur})\n      if(count==0){\n       clearInterval(timer);\n       session.finish();\n      }\n    },50);\n});', 1, '2017-01-22 22:50:31', '2017-02-06 19:48:06'),
(2, 1, 0, 1, '1.0.0', 'dSpider("xx",function(){\n error\n})', 2, '2017-01-23 18:47:25', '2017-02-07 03:18:28'),
(3, 5, 0, 1, '1.0.0', 'dSpider("qqmail", function (session, env, $) {\n    session.onNavigate = function (url) {\n        if (url.indexOf("://ui.ptlogin2.qq.com/cgi-bin/login?") != -1) {\n            session.showProgress();\n            session.autoLoadImg(false);\n        }\n    }\n    var index = location.href.indexOf("://w.mail.qq.com/cgi-bin/loginpage")\n    if (index < 7 && index > -1) {\n        var url = $(''.enter_mail_button_td a'').attr("href");\n        if (url) {\n            location.replace(url);\n        }\n        return\n    }\n    index = location.href.indexOf("://ui.ptlogin2.qq.com/cgi-bin/login?")\n    if (index < 7 && index > -1) {\n        $("#u").val(session.getLocal("username"));\n        $("#p").val(session.getLocal("pwd"));\n        session.showProgress(false);\n        $("#go").click(function () {\n            if (!session.getArguments().wd) {\n                confirm("缺少关键字")\n                session.finish("缺少关键字")\n            }\n            session.setLocal("username", $("#u").val());\n            session.setLocal("pwd", $("#p").val());\n        })\n        return\n    }\n\n    log("x1" + location.href);\n    if (location.href.indexOf("w.mail.qq.com/cgi-bin/today?sid=") != -1) {\n        var url = "https://w.mail.qq.com/cgi-bin/mobile?sid=$$sid&t=phone#today"\n        url = url.replace(/\\$\\$sid/g, qs[''sid''])\n        log("x2" + url)\n        location.href = url;\n    }\n\n    if (location.href.indexOf("w.mail.qq.com/cgi-bin/mobile?sid=") != -1) {\n        session.showProgress();\n        var wd = session.getArguments().wd;\n        var timeInterval = 300;\n        var sid = qs["sid"]\n        session.setProgressMsg("正在拉取邮件列表...")\n        $.get("mail_list?ef=js&sid=" + sid, {\n                t: "mobile_data.json",\n                s: "list",\n                cursor: "max",\n                cursorcount: 20,\n                cursorsearch: 1,\n                folderid: "all",\n                receiver:wd,\n                sender: wd,\n                subject: wd,\n                keyword: wd,\n                combinetype: "or",\n                device: "android",\n                app: "phone",\n                ver: "app"\n            })\n            .done(function (d) {\n                d = eval("(%s)".format(d));\n                if (!d.mls) {\n                    session.finish();\n                    return;\n                }\n                var mls = d.mls;\n                var count = 0\n                console.log(mls.length)\n                session.setProgressMax(mls.length);\n                function getData() {\n                    if (count == mls.length) {\n                        //结束\n                        log("end")\n                        session.setProgress(count)\n                        session.finish()\n                        return;\n                    }\n                    session.setProgress(count)\n                    session.setProgressMsg("正在获取第" + (count + 1) + "封邮件...")\n                    $.get("readmail?ef=js&sid=" + sid, {\n                        t: "mobile_data.json",\n                        s: "read",\n                        showreplyhead: 1,\n                        disptype: "html",\n                        mailid: mls[count++].inf.id\n                    }).done(function (d) {\n                            var d = eval("(%s)".format(d));\n                            if (d.errcode == "-15") {\n                                count--;\n                                if (timeInterval <= 2000)\n                                    timeInterval += 200;\n                                return\n                            }\n                            var html\n                            var name = "";\n                            var subj;\n                            var date;\n                            var addr;\n                            if (d.mls.length > 1) {\n                                html = d.mls[1].content.body || d.mls[1].content.fold[0][1] || "无内容";\n                                name = d.mls[1].inf.from.name;\n                                subj = d.mls[1].inf.subj;\n                                date = d.mls[1].inf.date;\n                                addr = d.mls[1].inf.from.addr;\n                            } else {\n                                html = d.mls[0].content.body || "无内容"\n                                name = d.mls[0].inf.from.name;\n                                subj = d.mls[0].inf.subj;\n                                date = d.mls[0].inf.date;\n                                addr = d.mls[0].inf.from.addr;\n                            }\n                            //数据组织为json格式\n                            var json = {\n                                sender: name + addr,\n                                subject: subj,\n                                date: date,\n                                html: html\n                            }\n                            //将数据传给端\n                            session.upload(json)\n                        })\n                        .always(function (t) {\n                            setTimeout(getData, timeInterval);\n                        })\n                        .fail(function (s) {\n                            log("error" + JSON.stringify(s));\n                        })\n                }\n\n                setTimeout(getData, timeInterval);\n            })\n            .fail(function (jqXHR) {\n                session.finish("ajax error", JSON.stringify(jqXHR), 1)\n                log(JSON.stringify(jqXHR))\n            })\n    }\n})', 0, '2017-02-07 02:12:22', '2017-02-07 23:39:28'),
(4, 6, 0, 1, '1.0.0', 'dSpider("email", function ( session, env, $) {\n    var wd=session.getArguments().wd;\n    var user=session.getLocal("username")\n    function formatParams(data) {\n        var arr = [];\n        for (var name in data) {\n            arr.push(encodeURIComponent(name) + "=" + encodeURIComponent(data[name]));\n        }\n        return arr;\n    }\n\n    function ajax(options) {\n        options = options || {};\n        options.type = (options.type || "GET").toUpperCase();\n        options.dataType = options.dataType || "json";\n        var params = formatParams(options.data);\n        options.success=safeCallback(options.success)\n        options.fail=safeCallback(options.fail)\n        options.complete=safeCallback(options.complete)\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState == 4) {\n                var status = xhr.status;\n                if (status >= 200 && status < 300) {\n                    options.success && options.success(xhr.responseText, xhr.responseXML);\n                } else if (status != 0) {\n                    options.fail && options.fail(JSON.stringify(xhr));\n                    log(xhr.readyState + xhr.responseText)\n                } else {\n                    session.finish("网络错误", "", 1)\n                }\n                options.complete();\n            }\n        }\n        var postParams = null;\n        if (options.type == "GET") {\n            xhr.open("GET", options.url + "?" + params, true);\n        } else if (options.type == "POST") {\n            xhr.open("POST", options.url, true);\n            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");\n            postParams = params;\n        }\n        xhr.setRequestHeader("accept", "application/json, text/javascript, */*; q=0.01");\n        xhr.send(postParams);\n        return xhr;\n    }\n\n\n    var index = location.href.indexOf("://smart.mail.1")\n    if (index < 7 && index > -1) {\n        $(".loginBtn").click(function(){\n            session.setLocal("username",$("#username,#user").val())  \n        })\n        $("#pop_mailEntry").click();\n        $("#username,#user").val(user)\n        $("#chkAutoLogin").val(0).attr("disabled", "disabled")\n        return\n    }\n    \n\n    session.showProgress();\n    if (location.href.indexOf("main.jsp") != -1) {\n        var search = ''<?xml version="1.0"?>\\\n               <object>\\\n               <string name="order">date</string>\\\n                <boolean name="desc">true</boolean>\\\n                <string name="operator">or</string>\\\n                <array name="condictions">\\\n                <object>\\\n                <string name="field">from</string>\\\n                <string name="operator">contains</string>\\\n                <string name="operand">%s</string>\\\n                <boolean name="ignoreCase">true</boolean>\\\n                </object>\\\n                <object>\\\n                <string name="field">subject</string>\\\n                <string name="operator">contains</string>\\\n                <string name="operand">%s</string>\\\n                <boolean name="ignoreCase">true</boolean>\\\n                </object>\\\n                </array>\\\n                <int name="windowSize">50</int>\\\n                </object>'';\n\n        var id = ''<?xml version="1.0"?>\\\n                <object>\\\n                <string name="id">%s</string>\\\n                <string name="mode">both</string>\\\n                <boolean name="autoName">true</boolean>\\\n                <boolean name="supportTNEF">true</boolean>\\\n                <boolean name="filterStylesheets">true</boolean>\\\n                <boolean name="returnImageInfo">true</boolean>\\\n                </object>''\n\n\n        var sid = qs["sid"]\n        log(wd+sid)\n        ajax({\n            url: "s?sid=" + sid + "&func=mbox:searchMessages",\n            data: {''var'': search.replace(/%s/g, wd)}, type: "post",\n            success: function (data) {\n                var d = eval("(" + data + ")");\n                d = $.map(d.var, function (e) {\n                    if (e instanceof Object) return e.id;\n                })\n                var count = d.length;\n                if (count == 0) {\n                    session.finish();\n                    return;\n                }\n                var start = 0;\n                session.set("count", count)\n                log(count)\n                $.each(d, function (i, e) {\n                    ajax({\n                        url: "s?sid=" + sid + "&func=mbox:readMessage&l=read&action=read",\n                        data: {var: id.replace(/%s/g, e)}, type: "post",\n                        success: function (data) {\n                            log(data)\n                            var c = eval("(" + data + ")");\n                            try {\n                                log(c.var.html.content)\n                                session.upload(c.var.html.content)\n                                //session.upload(c.var);\n                            } catch (e) {\n                                console.log(c.var.text.content)\n                                session.upload(c.var.text.content)\n                            }\n                        },\n                        complete: function () {\n                            console.log(++start)\n                            if (start == count) {\n                                session.finish();\n                                log(session.string())\n                            }\n                        }\n                    })\n                })\n\n            },\n            fail:function(msg){\n                session.finish("ajax error",msg,1);\n            }\n        });\n    }\n});', 0, '2017-02-07 19:14:40', '2017-02-07 22:23:18'),
(5, 7, 0, 1, '1.0.0', 'dSpider("126", function ( session, env, $) {\n    function formatParams(data) {\n        var arr = [];\n        for (var name in data) {\n            arr.push(encodeURIComponent(name) + "=" + encodeURIComponent(data[name]));\n        }\n        return arr;\n    }\n\n    function ajax(options) {\n        options = options || {};\n        options.type = (options.type || "GET").toUpperCase();\n        options.dataType = options.dataType || "json";\n        var params = formatParams(options.data);\n        options.success=safeCallback(options.success)\n        options.fail=safeCallback(options.fail)\n        options.complete=safeCallback(options.complete)\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState == 4) {\n                var status = xhr.status;\n                if (status >= 200 && status < 300) {\n                    options.success && options.success(xhr.responseText, xhr.responseXML);\n                } else if (status != 0) {\n                    options.fail && options.fail(JSON.stringify(xhr));\n                    log(xhr.readyState + xhr.responseText)\n                } else {\n                    session.finish("网络错误", "", 1)\n                }\n                options.complete();\n            }\n        }\n        var postParams = null;\n        if (options.type == "GET") {\n            xhr.open("GET", options.url + "?" + params, true);\n        } else if (options.type == "POST") {\n            xhr.open("POST", options.url, true);\n            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");\n            postParams = params;\n        }\n        xhr.setRequestHeader("accept", "application/json, text/javascript, */*; q=0.01");\n        xhr.send(postParams);\n        return xhr;\n    }\n\n\n    var index = location.href.indexOf("://smart.mail.1")\n    if (index < 7 && index > -1) {\n        $("#username,#user").val(session.getLocal("username"));\n        $("#password").val(session.getLocal("pwd"));\n        $(".loginBtn").click(function(){\n            if(!session.getArguments().wd){\n                confirm("缺少关键字")\n                session.finish("缺少关键字")\n            }\n            session.setLocal("username",$("#username,#user").val())\n            session.setLocal("pwd",$("#password").val())\n        })\n        $("#pop_mailEntry").click();\n        $("#chkAutoLogin").val(0).attr("disabled", "disabled")\n        return\n    }\n\n\n    session.showProgress();\n    if (location.href.indexOf("main.jsp") != -1) {\n        var wd=session.getArguments().wd;\n        var search = ''<?xml version="1.0"?>\\\n               <object>\\\n               <string name="order">date</string>\\\n                <boolean name="desc">true</boolean>\\\n                <string name="operator">or</string>\\\n                <array name="condictions">\\\n                <object>\\\n                <string name="field">from</string>\\\n                <string name="operator">contains</string>\\\n                <string name="operand">%s</string>\\\n                <boolean name="ignoreCase">true</boolean>\\\n                </object>\\\n                <object>\\\n                <string name="field">subject</string>\\\n                <string name="operator">contains</string>\\\n                <string name="operand">%s</string>\\\n                <boolean name="ignoreCase">true</boolean>\\\n                </object>\\\n                </array>\\\n                <int name="windowSize">50</int>\\\n                </object>'';\n\n        var id = ''<?xml version="1.0"?>\\\n                <object>\\\n                <string name="id">%s</string>\\\n                <string name="mode">both</string>\\\n                <boolean name="autoName">true</boolean>\\\n                <boolean name="supportTNEF">true</boolean>\\\n                <boolean name="filterStylesheets">true</boolean>\\\n                <boolean name="returnImageInfo">true</boolean>\\\n                </object>''\n\n\n        var sid = qs["sid"]\n        log(wd+sid)\n        ajax({\n            url: "s?sid=" + sid + "&func=mbox:searchMessages",\n            data: {''var'': search.replace(/%s/g, wd)}, type: "post",\n            success: function (data) {\n                var d = eval("(" + data + ")");\n                d = $.map(d.var, function (e) {\n                    if (e instanceof Object) return e.id;\n                })\n                var count = d.length;\n                if (count == 0) {\n                    session.finish();\n                    return;\n                }\n                var start = 0;\n                session.set("count", count)\n                log(count)\n                $.each(d, function (i, e) {\n                    ajax({\n                        url: "s?sid=" + sid + "&func=mbox:readMessage&l=read&action=read",\n                        data: {var: id.replace(/%s/g, e)}, type: "post",\n                        success: function (data) {\n                            log(data)\n                            var c = eval("(" + data + ")");\n                            var content;\n                            try {\n                                content=c.var.html.content\n                            } catch (e) {\n                                content=c.var.text.content\n                            }\n                            var json={\n                                sender: c.var.from[0],\n                                subject: c.var.subject,\n                                date: c.var.sendDate,\n                                html:content\n                            }\n                           session.upload(json)\n                        },\n                        complete: function () {\n                            console.log(++start)\n                            if (start == count) {\n                                session.finish();\n                                log(session.string())\n                            }\n                        }\n                    })\n                })\n\n            },\n            fail:function(msg){\n                session.finish("ajax error",msg,1);\n            }\n        });\n    }\n});', 0, '2017-02-07 22:00:39', '2017-02-07 22:24:03'),
(6, 8, 5, 1, '1.0.0', 'dSpider("sinaMail", function (session, env, $) {\n    $.fn.trigger_=function(e){\n        var evt = document.createEvent("MouseEvents");\n        evt.initEvent(e, false, false);\n        this[0].dispatchEvent(evt);\n        return this;\n    }\n    var index = location.href.indexOf("://mail.sina.cn/?")\n    if (index < 7 && index > -1) {\n        $("#mailFnCoverAndroid,#mailFnCoveriOS,#btnSkipCoverAndroid").hide()\n        $("input[name=savelogin]").val(0).parents("li").add("changeUrl>:last").hide()\n        $("input[name=username]").val(session.getLocal("username"));\n        $("input[name=passwd]").val(session.getLocal("pwd"));\n        session.showProgress(false);\n        $(".btn-submit").click(function () {\n            if (!session.getArguments().wd) {\n                confirm("缺少关键字")\n                session.finish("缺少关键字")\n            }\n            session.setLocal("username", $("input[name=username]").val());\n            session.setLocal("pwd", $("input[name=passwd]").val());\n        })\n        return\n    }\n    session.showProgress();\n    if (location.href.indexOf("mobile/index") != -1) {\n        var wd=session.getArguments().wd;\n        session.setProgressMsg("正在拉取邮件列表...")\n        $.post("../wa.php?a=findmail",{\n            keyword:wd,\n            order:"htime",\n            sorttype:"desc",\n            start:0,\n            length:40,\n        }).done(function(d){\n                var o = JSON.parse(d);\n                var count=o.data.maillist.length;\n                if(count==0){\n                    session.finish();\n                    return\n                }\n                session.setProgressMax(count);\n                var cur=0;\n            $.each(o.data.maillist,function(i,e){\n                $.post("../wa.php?a=readmail",{mid: e[0],fid:"new"})\n                    .done(function(d){\n                        var o = JSON.parse(d);\n                        var json = {\n                            sender:o.data[1],\n                            subject: o.data[3],\n                            date: o.data[4],\n                            html: o.data[25]\n                        }\n                        session.upload(json)\n                    })\n                    .fail(function(jqXHR){\n                        session.finish("ajax error",JSON.stringify(jqXHR))\n                    })\n                    .always(function(){\n                       ++cur\n                      session.setProgress(cur)\n                      session.setProgressMsg("正在爬取第"+cur+"封邮件...")\n                      if(cur==count){\n                          session.finish()\n                      }\n                    })\n            })\n\n        }).fail(function(jqXHR){\n            session.finish("ajax error",JSON.stringify(jqXHR))\n        });\n    }\n\n})', 0, '2017-02-08 00:39:50', '2017-02-08 01:43:17');
INSERT INTO `scripts` (`id`, `spider_id`, `callCount`, `online`, `min_sdk`, `content`, `priority`, `created_at`, `updated_at`) VALUES
(7, 2, 0, 1, '1.0.0', 'dSpider("taobao", 60*10 , function(session,env,$){\n    //禁止加载图片\n    session.autoLoadImg(false) ;\n    log(location.href);\n    alert = function(){};\n    //遇到错误页面继续爬取未完成的模块\n    if(location.pathname.indexOf("mtb/mtb.htm")!=-1){\n        location="https://h5.m.taobao.com/mlapp/mytaobao.html";\n    }\n\n    if(location.href.indexOf("intent://") != -1){\n        location="https://h5.m.taobao.com/mlapp/mytaobao.html";\n    }\n\n    if($("div.submit>button").text().indexOf("登 录") != -1){\n        session.setStartUrl();\n        //取出账号和密码填充进去\n        if(session.getLocal("TaoBaoUserName") != undefined && session.getLocal("TaoBaoPassWord") != undefined){\n            $("div.field-control>input#username")[0].value = session.getLocal("TaoBaoUserName");\n            $("div.field-control>input#password")[0].value = session.getLocal("TaoBaoPassWord");\n            $("div.field-control>input#username")[0].focus();\n        }\n        //点击登录的时候保存账号和密码\n        $("button#submit-btn")[0].onclick = function(){\n            session.setLocal("TaoBaoUserName",$("div.field-control>input#username")[0].value);\n            session.setLocal("TaoBaoPassWord",$("div.field-control>input#password")[0].value);\n        }\n    }\n\n    if (window.location.pathname.indexOf("mlapp/mytaobao") != -1) {\n        //taobaoState    0:爬账单  1:爬地址   2:爬个人信息   3:结束\n        var count = session.get("taobaoState");\n        if(count!=1&&count!=2&&count!=3){\n            if(count == 0){\n\n            }else{\n                session.set("taobaoState",0);\n                session.set("orderArray",[]);\n                //显示进度为0\n                session.showProgress(true);\n                session.setProgressMax(100);\n                //setProgressMsg("");\n                session.setProgress(2);\n            }\n//            document.getElementsByClassName("label-act")[0].children[0].children[0].click();//点击订单\n            location = "https://h5.m.taobao.com/mlapp/olist.html";//进入订单\n        }else if(count==1){\n            //跳转到网页版   www.taobao.com\n            session.set("AddressData",[]);\n            location.href="//www.taobao.com/index.php?from=wap";\n        }else if(count == 2){\n            location.href = "https://i.taobao.com/user/baseInfoSet.htm";\n        }\n    }\n\n\n    var state = session.get("taobaoState");\n    if(state == 0){\n            //获取订单列表\n            if (window.location.pathname.indexOf("mlapp/olist") != -1) {\n                var op = session.get("OrderItemPosition");\n                if(op == undefined){\n                    getOrderList();\n                }else{\n                    intoOrderDetail();\n                }\n            }\n            function getOrderList(){\n                log("--------------------------getOrderList方法----------------------------");\n                var myInterval;\n                //循环调用获取订单的方法\n                function getOrder() {\n//                    if($("div.order-more").length > 0 && window.getComputedStyle($("div.order-more")[0], ''::before'') != null){\n//                        if (window.getComputedStyle($("div.order-more")[0], ''::before'').getPropertyValue(''content'')||$(".order-list>li").length>=5) {//限制订单爬取的数量\n                    if($("div.order-more").length > 0 ){\n                        if ($(".order-list>li").length>=5) {//限制订单爬取的数量\n                            var tempOllLength = $(".order-list>li").length;\n                            var orderListArray = [];\n                            for(var tol = 0 ; tol < tempOllLength ; tol ++){\n                                orderListArray[tol] = ($($(".order-list>li")[tol]).children().eq(0)).attr("class").toString().split(" ")[1].substring(0,16);\n                            }\n                            session.set("orderIdList",orderListArray);//保存订单的id\n                            log("加载完成");\n                            clearInterval(myInterval);\n                            //进入订单\n                            session.set("OrderItemPosition",0);\n                            intoOrderDetail();\n                        } else {\n                            //需要继续请求订单\n                            document.getElementsByClassName("order-more")[0].click();//点击加载更多\n                            log("正在获取订单");\n                        }\n                    }else{\n                        log("  ::before  is  "+ window.getComputedStyle($("div.order-more")[0], ''::before'')+" ! " + "order-more length is " + $("div.order-more").length );\n                    }\n                }\n                myInterval = setInterval(getOrder, 3000);\n            }\n            /**\n             * 进入订单的爬取操作\n             */\n            function intoOrderDetail() {\n                log("--------------------------intoOrderDetail----------------------------");\n                if($(".order-list>li").length == 0){//当lengt为0的时候的处理\n                    setTimeout(intoOrderDetail,100);\n                    return;\n                }else{\n                    var position = session.get("OrderItemPosition");\n                    if(position >= $(".order-list>li").length){\n                        log("--------------------------length----------------------------"+$(".order-list>li").length);\n                        //更新状态并退回到个人页\n                        session.set("taobaoState",1);\n                        session.setProgress(65);\n                        location="https://h5.m.taobao.com/mlapp/mytaobao.html";\n                    }else{\n                        function toOrder(){\n                            ($($(".order-list>li")[position]).children().eq(3).children().eq(0).children().eq(1)).trigger("click");\n                            session.setProgress(5+(position/($(".order-list>li").length))*60);\n                            log("--------------------------进入订单----------------------------"+position);\n                        }\n                        setTimeout(toOrder,500);//必须延时执行该方法,因为click事件有可能还没有绑定到dom上\n                    }\n                }\n            }\n            //---------------------------------------------------------以上是从列表页点击进入详情页的逻辑,以下是处理每种不同订单的逻辑\n            /**\n             * 爬取订单数据\n             */\n            //特殊订单的处理----------------------电影票\n            if (window.location.pathname.indexOf("mymovie/pages") != -1) {\n                    var oa = session.get("orderArray");\n                    if(oa == undefined){\n                        session.set("taobaoState",-1);\n                        //关闭当前页面\n                        closeOrderDetail();\n                    }else{\n                        currentOrderData = oa;\n                        //拿到position后开始爬取\n                        var oip = session.get("OrderItemPosition");\n                        session.set("OrderItemPosition",oip+1);\n                        location = "https://h5.m.taobao.com/mlapp/olist.html";\n                    }\n            }\n            //特殊订单的处理----------------------保险\n            if (window.location.pathname.indexOf("bx/orderdetail.html") != -1) {\n                log("--------------------------爬取保险----------------------------");\n                var tmpeOay = session.get("orderArray");\n                if(tmpeOay == undefined){\n                    session.set("taobaoState",-1);\n                    //关闭当前页面\n                    closeOrderDetail();\n                }else{\n                    var tempOipn = session.get("OrderItemPosition");\n                    var bxtbOrderDetailInfo = {};\n                    bxtbOrderDetailInfo.products = [];\n                    var bxtotalProductArray = [];\n                    var myproducts = {};\n                    function getBxOrderDetail(){\n                        var tt = $("span.textarea");\n                        if(tt.length == 0){\n                            setTimeout(getBxOrderDetail,100);\n                            return;\n                        }\n                        var bxmyproducts = {};\n                        bxmyproducts.name = "保险";\n                        bxmyproducts.price = $(tt[2]).text();\n                        bxmyproducts.number = parseInt($(tt[3]).text());\n                        bxtbOrderDetailInfo.id = $(tt[1]).text();\n                        bxtbOrderDetailInfo.time = $(tt[5]).text();\n                        bxtbOrderDetailInfo.address = "无";\n                        bxtbOrderDetailInfo.total = parseInt($(tt[3]).text());\n                        bxtbOrderDetailInfo.products.push(bxmyproducts);\n                        bxtotalProductArray.push(bxtbOrderDetailInfo);\n                        tmpeOay.push(bxtotalProductArray);\n                        //保存数据\n                        session.set("orderArray",tmpeOay);\n                        //更新position\n                        session.set("OrderItemPosition",tempOipn+1);\n                        //跳转到列表页\n                        location = "https://h5.m.taobao.com/mlapp/olist.html";\n                        log("--------------------------爬取保险end----------------------------");\n                    }\n                    setTimeout(getBxOrderDetail,100);\n                }\n            }\n            //特殊订单的处理----------------------飞机票\n            if (window.location.pathname.indexOf("trip/flight") != -1) {\n                log("--------------------------爬取飞机票----------------------------");\n                var tmpeOay = session.get("orderArray");\n                if(tmpeOay == undefined){\n                    session.set("taobaoState",-1);\n                    //关闭当前页面\n                    closeOrderDetail();\n                }else{\n                    var tempOipn = session.get("OrderItemPosition");\n                    var bxtbOrderDetailInfo = {};\n                    bxtbOrderDetailInfo.products = [];\n                    var bxtotalProductArray = [];\n                    var myproducts = {};\n                    function getFJPOrderDetail(){\n                        if($("div.detail-list-item-box").length == 0){\n                            setTimeout(getFJPOrderDetail,100);\n                            return;\n                        }\n                        var bxmyproducts = {};\n                        bxmyproducts.name = $($("span.order-shareflight")[0]).text().trim();\n                        bxmyproducts.price = $("span.money").text().split("￥")[1];//$("div.price").text()\n                        bxmyproducts.number = "1";//1\n                        bxtbOrderDetailInfo.id = $($("div h5")[1]).text().split("订单号")[1];//\n                        bxtbOrderDetailInfo.time = $("span.date").text();//\n                        bxtbOrderDetailInfo.address = $("span.city").text().trim();//这里的地址写的是里程的起始站和终点站\n                        bxtbOrderDetailInfo.total = $("span.money").text().split("￥")[1];//div.price.text()\n                        bxtbOrderDetailInfo.products.push(bxmyproducts);\n                        bxtotalProductArray.push(bxtbOrderDetailInfo);\n                        tmpeOay.push(bxtotalProductArray);\n                        //保存数据\n                        session.set("orderArray",tmpeOay);\n                        //更新position\n                        session.set("OrderItemPosition",tempOipn+1);\n                        //跳转到列表页\n                        location = "https://h5.m.taobao.com/mlapp/olist.html";\n                        log("--------------------------爬取飞机票end----------------------------");\n                    }\n                    setTimeout(getFJPOrderDetail,100);\n                }\n            }\n            //-----------------------------------------位置类型订单的处理\n            if (window.location.pathname.indexOf("mlapp/olist") == -1&&//当前页面不是订单列表\n                window.location.pathname.indexOf("mymovie/pages") == -1&&//当前页面不是电影票订单\n                window.location.pathname.indexOf("bx/orderdetail") == -1&&//当前页面不是保险订单\n                window.location.pathname.indexOf("trip/flight") == -1&&//当前页面不是飞机票订单\n                window.location.pathname.indexOf("mlapp/odetail") == -1//当前页面不是淘宝订单\n                ) {\n                    var oa = session.get("orderArray");\n                    if(oa == undefined){\n                        session.set("taobaoState",-1);\n                        //关闭当前页面\n                        closeOrderDetail();\n                    }else{\n                        currentOrderData = oa;\n                        //拿到position后开始爬取\n                        var oip = session.get("OrderItemPosition");\n                        session.set("OrderItemPosition",oip+1);\n                        location = "https://h5.m.taobao.com/mlapp/olist.html";\n                    }\n            }\n\n\n            //订单详情,目前外卖的订单详情跟淘宝自己的订单详情布局链接都一致\n            if (window.location.pathname.indexOf("mlapp/odetail") != -1) {\n                session.set("detailUrl",window.location.href);\n                var currentPosition;\n                var currentOrderData = [];\n                function getOrderDetail() {\n                    //当前订单需要爬取的数据的对象\n                    var tbOrderDetailInfo = {};\n                    //创建订单详情的列表\n                    var orderInfoList = [];\n                    //拿到页面列表中所有的div\n                    var ol = $(".order-list>li>div");\n                    if(ol.length == 0){\n                        setTimeout(getOrderDetail,100);\n                        return;\n                    }\n                    log("--------------------------开始爬取订单----------------------------");\n                    for (var i = 0; i < ol.length; i++) {\n                        if (ol[i].className.indexOf("orderinfo") != -1) {\n                            //订单编号\n                            for (var j = 0; j < ol[i].children[0].childElementCount; j++) {\n                                var infoItem = $(ol[i].children[0].children[j]).text();\n                                if (infoItem.indexOf("订单编号") != -1) {\n                                    //截取订单编号\n                                    var orderNamber = infoItem.substring(infoItem.indexOf(":") + 1, infoItem.length);\n                                    tbOrderDetailInfo.id = orderNamber;\n                                }\n                            }\n                            //订单创建时间\n                            for (var j = 0; j < ol[i].children[0].childElementCount; j++) {\n                                var infoItem = $(ol[i].children[0].children[j]).text();\n                                if (infoItem.indexOf("创建时间") != -1) {\n                                    //截取订单创建时间\n                                    var orderCreatTime = infoItem.substring(infoItem.indexOf(":") + 1, infoItem.length);\n                                    tbOrderDetailInfo.time = orderCreatTime;\n                                }\n                            }\n                        }\n                        //商品名称\n                        if (ol[i].className.indexOf("item") != -1) {//---所有商品的item\n                            var productInfo = ol[i].children;//产品信息下所有的布局\n                            for (var k = 0; k < productInfo.length; k++) {\n                                //创建一个对象存放产品列表\n                                var myProductInfo = {};\n                                if (productInfo[k].className.indexOf("item-list") != -1) {\n                                    for (var m = 0; m < productInfo[k].children.length; m++) {\n                                        if (productInfo[k].children[m].className.indexOf("item-info") != -1) {//----item中产品信息\n                                            var order_product_info = productInfo[k].children[m];\n                                            for (var opi = 0; opi < order_product_info.children.length; opi++) {\n                                                var opiChildren = order_product_info.children[opi];\n                                                if (opiChildren.className.indexOf("title") != -1) {\n                                                    //商品名称\n                                                    myProductInfo.name = $(opiChildren).text();\n                                                }\n                                            }\n                                        }\n                                        if (productInfo[k].children[m].className.indexOf("item-pay") != -1) {//----item中产品价格和数量\n                                            var item_pay = productInfo[k].children[m];\n                                            for (var ip = 0; ip < item_pay.children.length; ip++) {\n                                                var ipChildren = item_pay.children[ip];\n                                                if (ipChildren.className.indexOf("item-pay-data") != -1) {\n                                                    var priceInfoArray = ipChildren.children;\n                                                    for (var pia = 0; pia < priceInfoArray.length; pia++) {\n                                                        if (priceInfoArray[pia].className.indexOf("price") != -1) {\n                                                            //商品价格\n                                                            var productPrice = $(priceInfoArray[pia]).text();\n                                                            if (productPrice.indexOf("￥") != -1) {\n                                                                productPrice = productPrice.substring(productPrice.indexOf("￥") + 1, productPrice.length)\n                                                            }\n                                                            myProductInfo.price = productPrice;\n                                                            break;\n                                                        }\n                                                    }\n                                                    for (var pia = 0; pia < priceInfoArray.length; pia++) {\n                                                        if (priceInfoArray[pia].className.indexOf("nums") != -1) {\n                                                            //商品数量\n                                                            var productNumber = $(priceInfoArray[pia]).text();\n                                                            if (productNumber.indexOf("x") != -1) {\n                                                                productNumber = productNumber.substring(productNumber.indexOf("x") + 1, productNumber.length);\n                                                            }\n                                                            myProductInfo.number = productNumber;\n                                                        }\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                            orderInfoList.push(myProductInfo);\n                        }\n                        //总计消费\n                        if (ol[i].className.indexOf("paydetail") != -1) {\n                            var priceInfoArray = ol[i].children[0].children;\n                            for (var pa = 0; pa < priceInfoArray.length; pa++) {\n                                var cc = priceInfoArray[pa].children;\n                                for (var cci = 0; cci < cc.length; cci++) {\n                                    if ($(cc[cci]).text().indexOf("实付款") != -1) {\n                                        var totalPrice = $(cc[cci + 1]).text();\n                                        if (totalPrice.indexOf("￥") != -1) {\n                                            totalPrice = totalPrice.substring(totalPrice.indexOf("￥") + 1, totalPrice.length);\n                                        }\n                                        tbOrderDetailInfo.total = totalPrice;\n                                        tbOrderDetailInfo.products = [];\n                                        if (orderInfoList.length > 1) {//说明此订单中有多个商品\n                                            for (var oil = 0; oil < orderInfoList.length; oil++) {\n                                                var myproducts = {};\n                                                myproducts.name = orderInfoList[oil].name;\n                                                myproducts.price = orderInfoList[oil].price;\n                                                myproducts.number = orderInfoList[oil].number;\n                                                tbOrderDetailInfo.products.push(myproducts);\n                                            }\n                                        } else if (orderInfoList.length == 1) {//此订单中只有一个商品\n                                            var myproducts = {};\n                                            myproducts.name = orderInfoList[0].name;\n                                            myproducts.price = orderInfoList[0].price;\n                                            myproducts.number = orderInfoList[0].number;\n                                            tbOrderDetailInfo.products.push(myproducts);\n                                        }\n                                        //存放数据\n                                        currentOrderData.push(tbOrderDetailInfo);\n                                        //保存数据\n                                        session.set("orderArray",currentOrderData);\n                                        //更新position\n                                        session.set("OrderItemPosition",currentPosition+1);\n                                        //关闭详情页\n                                        closeOrderDetail();\n                                    }\n                                }\n                            }\n                        }\n                        //订单地址\n                        if (ol[i].className.indexOf("address") != -1) {\n                            var addressArray = ol[i].children[0].children;\n                            for (var aa = 0; aa < addressArray.length; aa++) {\n                                if (addressArray[aa].className.indexOf("cont") != -1) {\n                                    var myAdArray = addressArray[aa].children;\n                                    for (var maa = 0; maa < myAdArray.length; maa++) {\n                                        if (myAdArray[maa].className.indexOf("submsg") != -1) {\n                                            var myAddress = $(myAdArray[maa]).text();\n                                            myAddress = myAddress.substring(myAddress.indexOf("：") + 1, myAddress.length);\n                                            tbOrderDetailInfo.address = myAddress;\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    log("--------------------------爬取订单end----------------------------");\n                }\n                var oay = session.get("orderArray");\n                if(oay == undefined){\n                    session.set("taobaoState",-1);\n                    //关闭当前页面\n                    closeOrderDetail();\n                }else{\n                    currentOrderData = oay;\n                    var oipn = session.get("OrderItemPosition");\n                    //拿到position后开始爬取\n                    currentPosition = oipn;\n                    getOrderDetail();\n                }\n                function closeOrderDetail(){\n//                    $("div.back").click();//订单详情页的返回\n                    location = "https://h5.m.taobao.com/mlapp/olist.html";\n                }\n            }\n        }\n    //------------------------------------------------------------------------------------爬取收货地址----------------------------------------------------------------------------\n    else if(state == 1){\n\n            if (window.location.hostname.indexOf("m.taobao.com") != -1) {\n                $(".my").click();//点击我的\n                location.href="//www.taobao.com/index.php?from=wap";\n            }\n            /**\n             * 爬取收货地址\n             */\n            if((window.location.hostname.indexOf("www.taobao.com") != -1)){\n                location.href = "//i.taobao.com/my_taobao.htm";\n            }\n\n            if((window.location.href.indexOf("i.taobao.com/my_taobao") != -1)){\n                dQuery("li.J_MtNavSubTrigger").children()[0].click();//进入到账号管理界面\n            }\n\n            if((window.location.hostname.indexOf("member1.taobao.com") != -1)){\n                if((window.location.href.indexOf("deliver_address") != -1)){\n                    if((window.location.href.indexOf("addrId") != -1)){\n                        var addressData = session.get("AddressData");\n                        var urlArray = session.get("addressUrlArray");\n                        var urlPosition = session.get("addressUrlPosition");\n                        if(addressData==undefined){\n                            addressData = [];\n                        }\n                        //取出爬到的数据并保存\n                        var tempAddaress =  {};\n                        tempAddaress.location = dQuery("div.city-title").text();//所在区域\n                        tempAddaress.address = dQuery("textarea#J_Street").text();//详细地址\n                        tempAddaress.zipcode = dQuery("input#J_PostCode").attr("value");//邮编\n                        tempAddaress.name = dQuery("input#J_Name").attr("value");//姓名\n                        tempAddaress.phone = dQuery("input#J_Mobile").attr("value");//电话号\n                        addressData.push(tempAddaress);\n                        session.set("AddressData",addressData);\n                        session.setProgress(65+(((urlPosition+1)/(urlArray.length))*20));\n                        if(urlPosition<urlArray.length-1){\n                            session.set("addressUrlPosition",urlPosition+1);\n                            location.href = urlArray[urlPosition+1];\n                        }else{\n                            session.set("taobaoState",2);\n                            session.setProgress(85);\n                            //爬取个人信息\n                            location.href = "https://i.taobao.com/user/baseInfoSet.htm";\n                        }\n                    }else {\n                        //dQuery("tbody>tr>td").map(function(){return dQuery(this).find("a")[0] }) 找出当前元素中的第一个子元素a\n                        //开始爬取地址\n                        var trList = dQuery("tbody>tr>td>a");\n                        var modifyUrlArray = [];\n                        for (var tl = 0; tl < trList.length; tl++) {\n                            if ("修改" == dQuery(trList[tl]).text()) {\n                                modifyUrlArray.push(dQuery(trList[tl]).attr("href"));\n                            }\n                        }\n                        //保存数据\n                        session.set("addressUrlArray",modifyUrlArray);\n                        //记录位置\n                        session.set("addressUrlPosition",0);\n                        location.href = modifyUrlArray[0];\n                    }\n                }else{\n                    location.href="https://member1.taobao.com/member/fresh/deliver_address.htm";\n                }\n            }\n        }\n    //------------------------------------------------------------------------------------爬取个人资料----------------------------------------------------------------------------\n    else if(state == 2){\n            /**\n             * 爬取个人信息\n             */\n            if(window.location.pathname.indexOf("baseInfoSet") != -1){//个人资料设置\n                var tempPersonInfo = {};\n                tempPersonInfo.name = dQuery("input#J_realname").attr("value");//姓名\n                //保存tempPersonInfo\n                session.set("persionInfo",tempPersonInfo);\n                session.setProgress(90);\n                location.href = "https://member1.taobao.com/member/fresh/account_security.htm";//跳转到安全设置拿电话\n            }\n            if(window.location.pathname.indexOf("account_security") != -1){//个人资料设置\n                var perInfo = session.get("persionInfo");\n                if(perInfo == undefined)\n                    perInfo = {};\n                //电话号码\n                var phone;\n                var username;\n                var tempArray = dQuery("span.t");\n                for(var ta = 0 ; ta<tempArray.length;ta++){\n                    if(dQuery(tempArray[ta]).text().indexOf("会员名")!=-1){\n                        username = dQuery(dQuery(tempArray[ta]).next()).text().trim();\n                    }\n                    if(dQuery(tempArray[ta]).text().indexOf("绑 定 手 机")!=-1){\n                        phone = dQuery(dQuery(tempArray[ta]).next()).text().trim();\n                    }\n                }\n                //保存手机号\n                perInfo.username = username;\n                perInfo.phone = phone;\n                session.set("persionInfo",perInfo);\n                session.setProgress(97);\n                //点击查看获取省份证号\n                dQuery("div.operate>a")[0].click();\n            }\n\n            if(window.location.pathname.indexOf("certify_info") != -1) {//身份认证界面\n                var perInfo = session.get("persionInfo");\n                if(perInfo == undefined)\n                     perInfo = {};\n                var tempArray = dQuery("div.explain-info>span");\n                var idcard_no;\n                for(var taa = 0 ; taa<tempArray.length;taa++){\n                    var title = dQuery(tempArray[taa]).text();\n                    if(title.indexOf("身份证号")!=-1){\n                        idcard_no = dQuery(dQuery(tempArray[taa]).next()).text();\n                    }\n                }\n                //保存身份证号 idcard_no\n                perInfo.idcard_no = idcard_no;\n                session.set("persionInfo",perInfo);\n                //修改状态\n                session.set("taobaoState",3);\n                session.setProgress(100);\n                uploadData();\n            }\n        }\n     else if(state == 3){\n        //爬取完成\n     }\n    function uploadData(){\n        var persionInfo = session.get("persionInfo");\n        var addData = session.get("AddressData");\n        var orderArray = session.get("orderArray");\n        if(persionInfo==undefined){\n            session.finish("upLoadData方法中的数据为空","persionInfo is undefined",2);\n        }else if(addData == undefined){\n            session.finish("upLoadData方法中的数据为空","addData is undefined",2);\n        }else if(orderArray == undefined){\n            session.finish("upLoadData方法中的数据为空","orderArray is undefined",2);\n        }\n        var data = {};\n        //存入ec_no TODO: ROY 这里是测试的ec_no\n        data.ec_no = "234578535";\n        //存入site_id\n        data.site_id = "1";\n        //存入个人信息\n        data.base_info = persionInfo;\n        //存入地址信息\n        var tempData = {};\n        tempData.contact_detail = addData;\n        data.contact_info = tempData;\n        //存入订单数据\n        var tempOrderDetail = {};\n        tempOrderDetail.order_detail = orderArray;\n        data.order_info = tempOrderDetail;\n        log("-------上传数据----------");\n        log(data);\n        session.upload(data);\n        session.finish();\n    }\n});', 0, '2017-02-08 18:39:53', '2017-02-08 18:44:08'),
(8, 3, 0, 1, '1.0.0', 'dSpider("jd", function (session, env, $) {\n\n    var infokey = "infokey";\n    var sid = "";\n    var max_order_num = 30;\n    var max_order_date = 100;\n    var globalInfo;\n\n    sid = session.get("sid");\n\n    if (location.href.indexOf("://m.jd.com") !== -1) {\n        session.showProgress(true);\n        session.setProgressMax(100);\n        session.autoLoadImg(false);\n        session.setProgress(5);\n\n        if ($(".jd-search-form-input")[0] !== undefined) {\n            sid = $(".jd-search-form-input")[0].children[0].value;\n            session.set("sid", sid);\n        }\n\n        session.set(infokey, new info({}, {}, {}));\n        globalInfo = session.get(infokey);\n        globalInfo.base_info.username = $("[report-eventid$=''MCommonHTail_Account'']").text().replace(/\\n/g, "").replace(/\\t/g, "");\n        saveInfo();\n        session.setProgress(10);\n        location.href = "https://home.m.jd.com/maddress/address.action?";\n    }\n\n    if (location.href.indexOf("://home.m.jd.com/maddress") != -1) {\n        session.setProgress(20);\n\n        globalInfo = session.get(infokey);\n\n        global_contact_info = new contact_info([]);\n        var taskAddr = [];\n        var urlarray = $(".ia-r");\n        for (var i = 0; i < urlarray.length; i++) {\n            taskAddr.push($.get(urlarray[i], function (response, status) {\n                var node = $("<div>").append($(response));\n                var name = $.trim(node.find("#uersNameId")[0].value);\n                var phone = $.trim(node.find("#mobilePhoneId")[0].value);\n                var addr = $.trim(node.find("#addressLabelId")[0].innerHTML);\n                var detail = $.trim(node.find("#address_where")[0].innerHTML);\n\n                global_contact_info.contact_detail.push(new contact(name, addr, detail, phone, ""));\n            }));\n\n        }\n\n\n        $.when.apply($, taskAddr).done(\n            // $.when(taskAddr).done(\n            function () {\n                globalInfo.contact_info = global_contact_info;\n                saveInfo();\n                session.setProgress(30);\n                getOrder();\n            });\n\n\n    }\n\n\n    function getOrder() {\n        session.setProgress(40);\n        globalInfo = session.get(infokey);\n        var orders = new order_info([]);\n        globalInfo.order_info = new order_info([]);\n        globalInfo.order_info.order_detail = [];\n        function getPageOrder(page) {\n            $.getJSON("https://home.m.jd.com//newAllOrders/newAllOrders.json?sid=" + sid + "&page=" + page, function (d) {\n                page++;\n                if (globalInfo.order_info.order_detail.length <= max_order_num && d.orderList.length !== 0 && (orders.order_detail.length === 0 || d.orderList[d.orderList.length - 1].orderId !== orders.order_detail[orders.order_detail.length - 1].orderId)) {\n                    orders.order_detail = orders.order_detail.concat(d.orderList);\n                    var task = [];\n                    if (globalInfo.order_info.order_detail.length < max_order_num) {\n                        if (d.orderList.length + globalInfo.order_info.order_detail.length > max_order_num) {\n                            d.orderList = d.orderList.slice(0, max_order_num - globalInfo.order_info.order_detail.length);\n                        }\n                        task.push($.each(d.orderList, function (i, e) {\n                            log("task push orderId: " + d.orderList[i].orderId);\n\n//                                           $.get("https://home.m.jd.com/newAllOrders/queryOrderDetailInfo.action?orderId="+ d.orderList[i].orderId+"&from=newUserAllOrderList&passKey="+d.passKeyList[i]+"&sid="+sid,\n//                                                   function(response,status){\n//                                                        log("orderId: " + d.orderList[i].orderId);\n//                                                        var addr = $("<div>").append($(response)).find(".step2-in-con").text();\n//                                                        var orderitem = new order(d.orderList[i].orderId,d.orderList[i].dataSubmit,d.orderList[i].price,addr);\n//\n//                                                        orderitem.products = [];\n//                                                        var products = $("<div>").append($(response)).find(".pdiv");\n//                                                        $.each(products,function(k, e){\n//                                                                                                       var name = $("<div>").append(products[k]).find(".sitem-m-txt").text();\n//                                                                                                       var price = $("<div>").append(products[k]).find(".sitem-r").text();\n//                                                                                                       var num = $("<div>").append(products[k]).find(".s3-num").text();\n//                                                                                                       orderitem.products.push(new product(name,  num ,price));\n//                                                         });\n//                                                         if(Date.parse(new Date()) < ((new Date(orderitem.time.split(" ")[0])).getTime() + max_order_date * 24 * 60 * 60 * 1000)){\n//                                                              if(globalInfo.order_info.order_detail.length < max_order_num){\n//                                                                   globalInfo.order_info.order_detail.push(orderitem);\n//                                                              }\n//                                                            }\n//                                                        });\n                            $.ajax({\n                                type: "get",\n                                url: "https://home.m.jd.com/newAllOrders/queryOrderDetailInfo.action?orderId=" + d.orderList[i].orderId + "&from=newUserAllOrderList&passKey=" + d.passKeyList[i] + "&sid=" + sid,\n                                async: false,\n                                success: function (response) {\n                                    log("orderId: " + d.orderList[i].orderId);\n                                    var addr = $.trim($("<div>").append($(response)).find(".step2-in-con").text());\n                                    var orderitem = new order(d.orderList[i].orderId, d.orderList[i].dataSubmit, d.orderList[i].price, addr);\n\n                                    orderitem.products = [];\n                                    var products = $("<div>").append($(response)).find(".pdiv");\n                                    $.each(products, function (k, e) {\n                                        var name = $.trim($("<div>").append(products[k]).find(".sitem-m-txt").text());\n                                        var price = $.trim($("<div>").append(products[k]).find(".sitem-r").text());\n                                        var num = $.trim($("<div>").append(products[k]).find(".s3-num").text());\n                                        orderitem.products.push(new product(name, num, price));\n                                    });\n                                    if (Date.parse(new Date()) < ((new Date(orderitem.time.split(" ")[0])).getTime() + max_order_date * 24 * 60 * 60 * 1000)) {\n                                        if (globalInfo.order_info.order_detail.length < max_order_num) {\n                                            globalInfo.order_info.order_detail.push(orderitem);\n                                        }\n                                    }\n                                }\n                            });\n                        }));\n                    }\n\n\n                    $.when(task).done(function () {\n                        log("get page :" + page);\n                        log("count: " + globalInfo.order_info.order_detail.length);\n                        getPageOrder(page);\n                        globalInfo.order_info.order_detail.sort(compare());\n                    });\n\n                } else {\n                    log("finish");\n                    saveInfo();\n                    session.setProgress(60);\n                    getUserInfo();\n                    return;\n                }\n            });\n        }\n\n        getPageOrder(1);\n    }\n\n    function compare() {\n        return function (a, b) {\n            var value1 = (new Date(a.time.split(" ")[0])).getTime();\n            var value2 = (new Date(b.time.split(" ")[0])).getTime();\n            return value2 - value1;\n        };\n    }\n\n    function getUserInfo() {\n        location.href = "https://home.m.jd.com/user/accountCenter.action";\n    }\n\n    if (location.href.indexOf("://home.m.jd.com/user/accountCenter.action") !== -1 && location.href.indexOf("loginpage") == -1) {\n        session.setProgress(70);\n        if ($(''#shimingrenzheng'')[0] !== undefined) {\n            $(''#shimingrenzheng'')[0].click();\n        }\n    }\n\n    //已实名用户\n    if (location.href.indexOf("msc.jd.com/auth/loginpage/wcoo/toAuthInfoPage") !== -1) {\n        session.setProgress(90);\n        globalInfo = session.get(infokey);\n        if ($(".pos-ab")[0] !== undefined) {\n            globalInfo.base_info.name = $(".pos-ab")[0].innerHTML;\n        }\n        if ($(".pos-ab")[1] !== undefined) {\n            globalInfo.base_info.idcard_no = $(".pos-ab")[1].innerHTML;\n        }\n        saveInfo();\n        logout();\n\n\n    }\n\n    function logout() {\n\n        //alert("爬取订单总计:" + session.get(infokey).order_info.order_detail.length);\n        //location.href = "https://passport.m.jd.com/user/logout.action?sid="+session.get("sid");\n        session.setProgress(100);\n        session.upload(session.get(infokey));\n        session.finish();\n    }\n\n    //快捷卡实名用户\n    if (location.href.indexOf("msc.jd.com/auth/loginpage/wcoo/toAuthPage") != -1) {\n        session.setProgress(90);\n        globalInfo = session.get(infokey);\n        if ($("#username")[0] !== undefined) {\n            globalInfo.base_info.name = $("#username")[0].innerHTML;\n        }\n        if ($(".info-user-name")[0] !== undefined) {\n            globalInfo.base_info.name = $(".info-user-name")[0].innerHTML;\n        }\n        if ($("#idcard")[0] !== undefined) {\n            globalInfo.base_info.idcard_no = $("#idcard")[0].innerHTML;\n        }\n        if ($(".pos-ab[data-cardno]") !== undefined) {\n            globalInfo.base_info.idcard_no = $(".pos-ab[data-cardno]").attr("data-cardno");\n        }\n\n        saveInfo();\n        logout();\n    }\n\n\n    // 缓存用户名密码\n    if (location.href.indexOf("https://plogin.m.jd.com/user/login.action?appid=100") != -1) {\n        $("#username").val(session.getLocal("username"));\n        $("#password").val(session.getLocal("password"));\n\n        $("#loginBtn").click(function () {\n            session.setLocal("password", $("#password").val());\n            session.setLocal("username", $("#username").val());\n        })\n\n    }\n\n\n    function saveInfo() {\n        session.set(infokey, globalInfo);\n    }\n\n\n    function addr(name, phone, addrdetail) {\n        this.name = name;\n        this.phone = phone;\n        this.addrdetail = addrdetail;\n    }\n\n    var address = [];\n    var global_contact_info;\n\n\n    function info(base_info, contact_info, order_info) {\n        this.site_id = 2;\n        this.base_info = base_info;\n        this.contact_info = contact_info;\n        this.order_info = order_info;\n    }\n\n    function base_info(username, name, idcard_no, phone) {\n        this.username = username;\n        this.name = name;\n        this.idcard_no = idcard_no;\n        this.phone = phone;\n    }\n\n\n    function contact_info(contact_detail) {\n        this.contact_detail = contact_detail;\n    }\n\n    function contact(name, location, address, phone, zipcode) {\n        this.name = name;\n        this.location = location;\n        this.address = address;\n        this.phone = phone;\n        this.zipcode = zipcode;\n    }\n\n    function order_info(order_detail) {\n        this.order_detail = order_detail;\n    }\n\n    function order(id, time, total, address) {\n        this.id = id;\n        this.time = time;\n        this.total = total;\n        this.address = address;\n    }\n\n    function product(name, number, price) {\n        this.name = name;\n        this.number = number;\n        this.price = price;\n    }\n\n    // 增加判断当前页面是否是登录页  modify by renxin 2017.1.17\n    if ($("#loginOneStep").length && $("#loginOneStep").length > 0) {\n        session.setStartUrl();\n    }\n\n\n//end\n});', 0, '2017-02-08 18:46:28', '2017-02-08 18:47:20');
INSERT INTO `scripts` (`id`, `spider_id`, `callCount`, `online`, `min_sdk`, `content`, `priority`, `created_at`, `updated_at`) VALUES
(9, 4, 0, 1, '1.0.0', 'dSpider("alipay", function (session, env, $) {\n    log("current page url: " + location.href);\n    var monthArray = [];\n    var uploadMonArray = []; //上传的月份数据\n    var monCount = 3; //需要爬取的月份\n    var sumCount = monCount + 1;\n    var now = new Date();\n\n    // 增加判断当前页面是否是登录页 \n    if ($("#J-loginMethod-tabs").length && $("#J-loginMethod-tabs").length > 0) {\n        session.setStartUrl();\n    }\n\n    if (window.location.href.indexOf(''/account/index.htm'') != -1) {\n        session.showProgress(true);\n        session.setProgressMax(100);\n        session.setProgress(0);\n\n        fetchUserInfo();\n        var delay = 500; //为了动画500ms\n        setTimeout(function () {\n            session.setProgress(100.0 / (sumCount));\n        }, delay);\n\n        jumptoOrderListPage();\n    }\n\n    if (window.location.href.indexOf(''/record/advanced.htm'') != -1) {\n        switchVersion();\n    }\n\n    if (window.location.href.indexOf(''/record/standard.htm'') != -1) {\n        spideOrder();\n    }\n\n    //开始爬取交易记录\n    function spideOrder() {\n        var endDate = formateDate(now);\n        now.setMonth(now.getMonth() - 1);\n        var beginDate = formateDate(now);\n        log(''--------------start spideOrder------------'' + ''beginDate:'' + beginDate + ''|endDate:'' + endDate)\n        fetchOrderListBy(1, beginDate, endDate);\n    }\n\n    //获取交易记录 pageNum:第几页  beginDate:开始时间  endDate:结束时间\n    function fetchOrderListBy(pageNum, beginDate, endDate) {\n        log(''---------fetchOrderListBy--------------'')\n        log(''---------start spide order:【'' + pageNum + ''】page-------'');\n        var daterange = ''customDate'';\n        var beginTime = ''00:00'';\n        var endTime = ''24:00'';\n\n        $.ajax({\n            url: ''https://consumeprod.alipay.com/record/standard.htm'',\n            type: ''post'',\n            data: ''pageNum='' + pageNum + ''&beginDate='' + beginDate + ''&endDate='' + endDate + ''&dateRange='' + daterange + ''&beginTime='' + beginTime + ''&endTime='' + endTime,\n            dataType: ''html'',\n            async: true,\n            cache: false,\n            success: function (data) {\n                var res = $(data).find(''#tradeRecordsIndex'');\n                if ($(res).find(''tbody:has(td)'').length == 0) { //到达最后一页\n                    log(''beginDate:'' + beginDate + ''|endDate:'' + endDate + ''|uploadMonArray:'' + uploadMonArray);\n\n                    uploadMonArray = uploadMonArray.concat([{\n                        begin_date: beginDate,\n                        end_date: endDate,\n                        begin_time: beginTime,\n                        end_time: endTime,\n                        data: monthArray,\n                    }]);\n\n                    monCount = monCount - 1;\n                    session.setProgress(100.0 * (sumCount - monCount) / sumCount);\n\n                    if (monCount == 0) { //爬取结束\n                        log(''----------------spideOrder finish!!!----------------- beginDate:'' + beginDate + ''|endDate:'' + endDate + '' && monthArray:'' + monthArray);\n                        var uploadData = {\n                            order_info: uploadMonArray\n                        };\n                        session.upload(uploadData);\n                        finish();\n                    } else { //爬取一个月的数据结束\n                        log(''----------------spideOrder single_month over!!!----------------- beginDate:'' + beginDate + ''|endDate:'' + endDate + '' && monthArray:'' + monthArray);\n                        spideOrder();\n\n                    }\n                    monthArray = []; //上传后清空\n\n                } else {\n                    var data = $(res).find(''tbody'').find(''tr:has(td)'').map(function (index) {\n                        var i = index + 1;\n\n                        return { //拼接上传数据\n                            name: formateStr($(this).find(''p.consume-title'').text()),\n                            time: formateStr($(this).find(''td.time > p:nth-child(1)'').text()) + ''   '' + formateStr($(this).find(''td.time > p:nth-child(2)'').text()),\n                            amount: formateStr($(this).find(''span.amount-pay'').text()),\n                            tradeNo: formateStr($(this).find(''#J-tradeNo-'' + i).attr(''title'')),\n                        }\n                    }).get();\n\n                    monthArray = monthArray.concat(data);\n                    fetchOrderListBy(pageNum + 1, beginDate, endDate);\n                }\n\n            },\n            error: function (xhr, data) {\n                log("-----------spider【" + pageNum + "】page error!!!");\n                finish();\n            }\n        });\n    }\n\n    //获取用户信息\n    function fetchUserInfo() {\n        log(''--------------fetchUserInfo-----------------------'')\n        var userInfo = new Object();\n        userInfo.name = $("#username").text();\n        userInfo.certId = $(''#account-main > div > table > tbody > tr:nth-child(1) > td:nth-child(2) > span:nth-child(3)'').text();\n        userInfo.bVerify = $(''#account-main > div > table > tbody > tr:nth-child(1) > td:nth-child(2) > span:nth-child(4)'').text();\n        userInfo.mail = $(''#account-main > div > table > tbody > tr:nth-child(2) > td:nth-child(2) > span'').text();\n        userInfo.phone = $(''#account-main > div > table > tbody > tr:nth-child(3) > td:nth-child(2) > span'').text();\n        userInfo.taoId = $(''#account-main > div > table > tbody > tr:nth-child(4) > td:nth-child(2)'').text();\n        userInfo.regTime = $(''#account-main > div > table > tbody > tr:nth-child(7) > td:nth-child(2)'').text();\n        userInfo.bankCard = $(''#J-bankcards > td:nth-child(2) > span'').text();\n\n        session.upload({\n            user_info: userInfo\n        });\n        log(userInfo);\n    }\n\n    //跳到交易记录\n    function jumptoOrderListPage() {\n        log(''----------jumptoOrderListPage-----------'')\n        location.href = "https://consumeprod.alipay.com/record/standard.htm";\n    }\n\n    //切换交易记录显示版本（标准、高级）\n    function switchVersion() {\n        log(''--------------switchVersion------------'')\n        $(''div.link > a'')[0].click(function () {\n            location.href = $(''#'' + $(this).attr(''rel'')).attr(''href'');\n        });\n    }\n\n    //结束爬取\n    function finish() {\n        log("---------------spider end success------------------------");\n        session.setProgress(100);\n        session.finish();\n    }\n\n    //转成标准格式字符串\n    function formateDate(date) {\n        var day = date.getDate();\n        var month = date.getMonth() + 1;\n        var year = date.getFullYear();\n        return year + ''.'' + month + ''.'' + day;\n    }\n\n    //去除多余转义字符,前后空格\n    function formateStr(s) {\n        if (!isEmpty(s)) {\n            var ss = s.replace(/(^\\s*)|(\\s*$)/g, '''');\n            return ss.replace(/[\\''\\"\\\\\\/\\b\\f\\n\\r\\t]/g, '''');\n        }\n        return '''';\n    }\n\n    function isEmpty(str) {\n        return (!str || 0 === str.length);\n    }\n\n    //用户信息\n    function userInfo(name, mail, phone, taoId, regTime, certId, bVerify, bankCard) {\n        this.name = name; //真实名字\n        this.mail = mail; //邮箱\n        this.phone = phone; //手机号\n        this.taoId = taoId; //淘宝id\n        this.regTime = regTime; //注册时间\n        this.certId = certId; //身份证\n        this.bVerify = bVerify; //是否认证\n        this.bankCard = bankCard; //绑定银行卡个数\n    }\n\n    //交易记录\n    function OrderInfo(name, time, amount, tradeNo) {\n        this.name = name; //交易名字\n        this.time = time; //交易时间\n        this.amount = amount; //交易金额\n        this.tradeNo = tradeNo; //流水号\n    }\n\n})', 0, '2017-02-08 18:50:25', '2017-02-08 18:50:25'),
(10, 9, 0, 1, '1.0.0', 'dSpider("unicom", 60*5, function(session,env,$){\n\n    function parseThxd(msg) {\n        $(msg).find("tr.tips_dial").each(function() {\n            var data = {}\n            data["otherNo"] = $(this).find("label.telphone").text();\n            data["callTime"] = $(this).find("td:eq(1) p").first().text();\n            data["callFee"] = $(this).find("p.time:eq(0)").text().replace(/[\\n|\\s]/g, "").replace();\n            data["callBeginTime"] = $(this).find("p.time:eq(1)").text().replace(/[\\n|\\s]/g, "").replace();\n            data["callType"] = ($(this).find(".call_out").length == 1) ? "主叫" : "被叫";\n\n            var monthData = session.get("curMonthData");\n            var datas = monthData["data"];\n            if(!datas) {\n                datas = [];\n            }\n            datas.push(data);\n            monthData["data"] = datas;\n            session.set("curMonthData", monthData);\n            log("获取一条数据：" + JSON.stringify(data));\n        })\n    }\n\n    function getThxdByAjax(year, month) {\n        log("开始爬取【" + month + "】月份通话详单：");\n        //session.upload("开始爬取【" + month + "】月份通话详单：")\n        var curMonthData = {};\n        curMonthData["calldate"] = year + "" + month;\n        curMonthData["cid"] = parseInt(new Date().getTime()/1000).toString();\n        session.set("curMonthData", curMonthData);\n        $.ajax({\n            url: ''/mobileService/query/getPhoneByDetailContent.htm'',\n            type: ''post'',\n            data: ''t='' + new Date().getTime() + ''&YYYY='' + year + ''&MM='' + month + ''&DD=&queryMonthAndDay=month&menuId='',\n            //dataType: ''html'',\n            //async: true,\n            //cache: false,\n            success: function(msg) {\n                log("请求" + month + "月份数据成功....");\n                parseThxd(msg);\n                $(''#pageNew'').html(msg);\n                //保存数据\n                var data = session.get("curMonthData");\n                data["totalCount"] = window.totalrow;\n                data["status"] = 4;\n                session.set("curMonthData", data);\n\n                //是否需要加载更多\n                if (window.endrow < window.totalrow) {\n                    loadMore();\n                } else {\n                    var thxd = session.get("thxd");\n                    if(!thxd) {\n                        thxd = {};\n                        thxd["month_status"] = [];\n                    }\n                    thxd["month_status"].push(data);\n                    session.set("thxd", thxd);\n                    session.set("curMonthData", "");\n                    log("爬取数据完成..." + JSON.stringify(data));\n                    spide();\n                }\n            },\n            error: function(xhr, msg){\n                //保存数据\n                var data = session.get("curMonthData");\n                data["totalCount"] = 0;\n                data["status"] = 2;\n                data["data"] = [];\n                var thxd = session.get("thxd");\n                if(!thxd) {\n                    thxd = {};\n                    thxd["month_status"] = [];\n                }\n                thxd["month_status"].push(data);\n                session.set("thxd", thxd);\n                session.set("curMonthData", "");\n\n                log("爬取【" + month + "】月份通话详单失败！");\n                spide();\n            }\n        });\n    }\n\n    function loadMore() {\n        log("加载更多...")\n        var _this = $(this);\n        var beginrow = window.endrow;\n        window.endrow = window.beginrow + window.perrow;\n        if (window.endrow > window.totalrow) {\n            window.endrow = window.totalrow;\n        }\n        _this.html(''<img src="http://img.client.10010.com/mobileService/view/client/images/loading.gif" width="16">'');\n        var href = ''/mobileService/view/client/query/xdcx/thxd_more_list.jsp?1=1&t='' + window.getrandom();\n        var params = ''&beginrow='' + beginrow + ''&endrow='' + window.endrow + ''&pagenum='' + (window.pagenum + 1);\n        $(''.moredetail'' + window.pagenum).load(href + params, function(msg) {\n            parseThxd(msg);\n            var thxd = session.get("thxd");\n            if(!thxd) {\n                thxd = {};\n                thxd["month_status"] = [];\n            }\n            thxd["month_status"].push(session.get("curMonthData"));\n            session.set("thxd", thxd);\n            session.set("curMonthData", "");\n            //继续爬取\n            spide();\n        });\n    }\n\n    function spide() {\n        var monthArr = session.get("months");\n        if (monthArr && monthArr.length > 0) {\n            session.setProgress(session.get("max") - monthArr.length - 1);\n            var monthObj = monthArr.shift();\n            session.set("months", monthArr);\n            getThxdByAjax(monthObj.year, monthObj.month);\n        } else {\n            var thxd = session.get("thxd");\n            log("爬取通话详单完毕----------" + JSON.stringify(thxd));\n            //跳转到服务首页\n            window.location.href = "http://wap.10010.com/mobileService/siteMap.htm";\n        }\n    }\n\n    function endSpide(thxd) {\n        log("爬取完毕----------" + JSON.stringify(thxd));\n        session.upload(JSON.stringify(thxd));\n        session.setProgress(session.get("max") - 0);\n        session.finish();\n        session.showProgress(false);\n    }\n\n    if(window.location.href.indexOf("/uac.10010.com/oauth2/new_auth") != -1) {\n        session.showProgress(false);\n    } if(window.location.href.indexOf(''query/getPhoneByDetailTip.htm'') != -1){\n        //显示loading\n        session.showProgress();\n\n        //计算月份信息\n        var date = new Date();\n        var curMonth = date.getMonth() + 1;\n        var curYear = date.getFullYear();\n        var monthArr = []\n        for (var i = 0; i < 6; i++) {\n            var month = curMonth - i;\n            var year = curYear;\n            if (month < 1) {\n                month += 12;\n                year -= 1;\n            }\n            if (month < 10) {\n                month = "0" + month;\n            }\n            monthArr.push({ "year": year, "month": month });\n        }\n        var max = monthArr.length + 1;\n        //设置月份信息\n        session.set("months", monthArr);\n        session.set("max", max);\n        session.setProgressMax(max);\n        log("开始爬取....." + JSON.stringify(monthArr));\n        spide();\n    } else if(window.location.href.indexOf(''mobileService/siteMap.htm'') != -1){//服务界面，获取个人信息跳转\n        var infoTag = "";\n        $(".checklistcontainer.newmore").find("li").each(function(){\n            if($(this).html().indexOf("基本信息") != -1) {\n                infoTag = $(this);\n                return;\n            }\n        });\n        if(infoTag) {\n            //跳转到我的基本信息页面\n            window.location.href = infoTag.attr("name");\n        } else {\n            log("用户信息获取失败.....");\n            var thxd = session.get("thxd");\n            thxd["user_info"] = {};\n            endSpide(thxd);\n        }\n    } else if(window.location.href.indexOf("t/operationservice/getUserinfo.htm") !=-1 ) {//获取个人信息\n        log("开始爬取用户信息----------");\n        var userInfo = {};\n        try {\n            userInfo["mobile"] = $(".clientInfo4_top").find("p:eq(0)").html().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["name"] = $(".clientInfo4_list").find("li:eq(0)").find("span:eq(1)").html().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["taocan"] = $(".clientInfo4_list").find("li:eq(1)").find("span:eq(1)").html().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["registration_time"] = $(".detail_con.con_ft:eq(0)").find("p:eq(6)").find("span:eq(1)").text().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["idcard_no"] = $(".detail_con.con_ft:eq(1)").find("p:eq(4)").find("span:eq(1)").text().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["household_address"] = $(".detail_con.con_ft:eq(1)").find("p:eq(18)").find("span:eq(1)").text().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        log("爬取用户信息结束-----" + JSON.stringify(userInfo));\n        var thxd = session.get("thxd");\n        thxd["user_info"] = userInfo;\n        var len = thxd["month_status"].length;\n        for(var i = 0; i < len; i ++) {\n            thxd["month_status"][i]["mobile"] = userInfo["mobile"];\n        }\n        endSpide(thxd);\n    }\n})', 0, '2017-02-08 18:54:56', '2017-02-08 18:54:56'),
(11, 9, 0, 1, '1.0.0', 'dSpider("unicom", 60*5, function(session,env,$){\n\n    function parseThxd(msg) {\n        $(msg).find("tr.tips_dial").each(function() {\n            var data = {}\n            data["otherNo"] = $(this).find("label.telphone").text();\n            data["callTime"] = $(this).find("td:eq(1) p").first().text();\n            data["callFee"] = $(this).find("p.time:eq(0)").text().replace(/[\\n|\\s]/g, "").replace();\n            data["callBeginTime"] = $(this).find("p.time:eq(1)").text().replace(/[\\n|\\s]/g, "").replace();\n            data["callType"] = ($(this).find(".call_out").length == 1) ? "主叫" : "被叫";\n\n            var monthData = session.get("curMonthData");\n            var datas = monthData["data"];\n            if(!datas) {\n                datas = [];\n            }\n            datas.push(data);\n            monthData["data"] = datas;\n            session.set("curMonthData", monthData);\n            log("获取一条数据：" + JSON.stringify(data));\n        })\n    }\n\n    function getThxdByAjax(year, month) {\n        log("开始爬取【" + month + "】月份通话详单：");\n        //session.upload("开始爬取【" + month + "】月份通话详单：")\n        var curMonthData = {};\n        curMonthData["calldate"] = year + "" + month;\n        curMonthData["cid"] = parseInt(new Date().getTime()/1000).toString();\n        session.set("curMonthData", curMonthData);\n        $.ajax({\n            url: ''/mobileService/query/getPhoneByDetailContent.htm'',\n            type: ''post'',\n            data: ''t='' + new Date().getTime() + ''&YYYY='' + year + ''&MM='' + month + ''&DD=&queryMonthAndDay=month&menuId='',\n            //dataType: ''html'',\n            //async: true,\n            //cache: false,\n            success: function(msg) {\n                log("请求" + month + "月份数据成功....");\n                parseThxd(msg);\n                $(''#pageNew'').html(msg);\n                //保存数据\n                var data = session.get("curMonthData");\n                data["totalCount"] = window.totalrow;\n                data["status"] = 4;\n                session.set("curMonthData", data);\n\n                //是否需要加载更多\n                if (window.endrow < window.totalrow) {\n                    loadMore();\n                } else {\n                    var thxd = session.get("thxd");\n                    if(!thxd) {\n                        thxd = {};\n                        thxd["month_status"] = [];\n                    }\n                    thxd["month_status"].push(data);\n                    session.set("thxd", thxd);\n                    session.set("curMonthData", "");\n                    log("爬取数据完成..." + JSON.stringify(data));\n                    spide();\n                }\n            },\n            error: function(xhr, msg){\n                //保存数据\n                var data = session.get("curMonthData");\n                data["totalCount"] = 0;\n                data["status"] = 2;\n                data["data"] = [];\n                var thxd = session.get("thxd");\n                if(!thxd) {\n                    thxd = {};\n                    thxd["month_status"] = [];\n                }\n                thxd["month_status"].push(data);\n                session.set("thxd", thxd);\n                session.set("curMonthData", "");\n\n                log("爬取【" + month + "】月份通话详单失败！");\n                spide();\n            }\n        });\n    }\n\n    function loadMore() {\n        log("加载更多...")\n        var _this = $(this);\n        var beginrow = window.endrow;\n        window.endrow = window.beginrow + window.perrow;\n        if (window.endrow > window.totalrow) {\n            window.endrow = window.totalrow;\n        }\n        _this.html(''<img src="http://img.client.10010.com/mobileService/view/client/images/loading.gif" width="16">'');\n        var href = ''/mobileService/view/client/query/xdcx/thxd_more_list.jsp?1=1&t='' + window.getrandom();\n        var params = ''&beginrow='' + beginrow + ''&endrow='' + window.endrow + ''&pagenum='' + (window.pagenum + 1);\n        $(''.moredetail'' + window.pagenum).load(href + params, function(msg) {\n            parseThxd(msg);\n            var thxd = session.get("thxd");\n            if(!thxd) {\n                thxd = {};\n                thxd["month_status"] = [];\n            }\n            thxd["month_status"].push(session.get("curMonthData"));\n            session.set("thxd", thxd);\n            session.set("curMonthData", "");\n            //继续爬取\n            spide();\n        });\n    }\n\n    function spide() {\n        var monthArr = session.get("months");\n        if (monthArr && monthArr.length > 0) {\n            session.setProgress(session.get("max") - monthArr.length - 1);\n            var monthObj = monthArr.shift();\n            session.set("months", monthArr);\n            getThxdByAjax(monthObj.year, monthObj.month);\n        } else {\n            var thxd = session.get("thxd");\n            log("爬取通话详单完毕----------" + JSON.stringify(thxd));\n            //跳转到服务首页\n            window.location.href = "http://wap.10010.com/mobileService/siteMap.htm";\n        }\n    }\n\n    function endSpide(thxd) {\n        log("爬取完毕----------" + JSON.stringify(thxd));\n        session.upload(JSON.stringify(thxd));\n        session.setProgress(session.get("max") - 0);\n        session.finish();\n        session.showProgress(false);\n    }\n\n    if(window.location.href.indexOf("/uac.10010.com/oauth2/new_auth") != -1) {\n        session.showProgress(false);\n    } if(window.location.href.indexOf(''query/getPhoneByDetailTip.htm'') != -1){\n        //显示loading\n        session.showProgress();\n\n        //计算月份信息\n        var date = new Date();\n        var curMonth = date.getMonth() + 1;\n        var curYear = date.getFullYear();\n        var monthArr = []\n        for (var i = 0; i < 6; i++) {\n            var month = curMonth - i;\n            var year = curYear;\n            if (month < 1) {\n                month += 12;\n                year -= 1;\n            }\n            if (month < 10) {\n                month = "0" + month;\n            }\n            monthArr.push({ "year": year, "month": month });\n        }\n        var max = monthArr.length + 1;\n        //设置月份信息\n        session.set("months", monthArr);\n        session.set("max", max);\n        session.setProgressMax(max);\n        log("开始爬取....." + JSON.stringify(monthArr));\n        spide();\n    } else if(window.location.href.indexOf(''mobileService/siteMap.htm'') != -1){//服务界面，获取个人信息跳转\n        var infoTag = "";\n        $(".checklistcontainer.newmore").find("li").each(function(){\n            if($(this).html().indexOf("基本信息") != -1) {\n                infoTag = $(this);\n                return;\n            }\n        });\n        if(infoTag) {\n            //跳转到我的基本信息页面\n            window.location.href = infoTag.attr("name");\n        } else {\n            log("用户信息获取失败.....");\n            var thxd = session.get("thxd");\n            thxd["user_info"] = {};\n            endSpide(thxd);\n        }\n    } else if(window.location.href.indexOf("t/operationservice/getUserinfo.htm") !=-1 ) {//获取个人信息\n        log("开始爬取用户信息----------");\n        var userInfo = {};\n        try {\n            userInfo["mobile"] = $(".clientInfo4_top").find("p:eq(0)").html().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["name"] = $(".clientInfo4_list").find("li:eq(0)").find("span:eq(1)").html().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["taocan"] = $(".clientInfo4_list").find("li:eq(1)").find("span:eq(1)").html().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["registration_time"] = $(".detail_con.con_ft:eq(0)").find("p:eq(6)").find("span:eq(1)").text().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["idcard_no"] = $(".detail_con.con_ft:eq(1)").find("p:eq(4)").find("span:eq(1)").text().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        try{\n            userInfo["household_address"] = $(".detail_con.con_ft:eq(1)").find("p:eq(18)").find("span:eq(1)").text().replace(/[\\n|\\s]/g, "").replace();\n        } catch (e) {\n        }\n        log("爬取用户信息结束-----" + JSON.stringify(userInfo));\n        var thxd = session.get("thxd");\n        thxd["user_info"] = userInfo;\n        var len = thxd["month_status"].length;\n        for(var i = 0; i < len; i ++) {\n            thxd["month_status"][i]["mobile"] = userInfo["mobile"];\n        }\n        endSpide(thxd);\n    }\n})', 0, '2017-02-08 18:55:03', '2017-02-08 18:55:03'),
(12, 10, 0, 1, '1.0.0', 'dSpider("mobile",function(session,env,$) {\n        \n        checkLogin_first();\n        \n        // -------------------------------------------\n        function checkLogin_first() {\n        \n        var xd_phone = session.get("xd_phone");\n        window.xd_phone = xd_phone;\n        if (window.xd_phone) {\n        session.autoLoadImg(false)\n        checkLogin_second();\n        return;\n        }\n        \n        var cts = ''login.10086.cn'';\n        var cts2 = ''channelID'';\n        if (window.location.href.indexOf(cts) >= 0 && window.location.href.indexOf(cts2) >= 0) {\n        \n        if ($(''#getSMSpwd'').length) {\n        $(''#getSMSpwd'').click(function () {\n                              session.set("firstSMSTime",new Date().getTime() + '''');\n                              });\n        }\n        \n        if ($(''#getPhoneSMSpwd'').length) {\n        $(''#getPhoneSMSpwd'').click(function () {\n                                   session.set("firstSMSTime",new Date().getTime() + '''');\n                                   });\n        }\n        \n        $(''#submit_bt'').click(function () {\n                              \n                              //存储手机号\n                              if ($(''#account_nav'').attr(''class'') == ''on'') {\n                              session.set("xd_phone",$(''#p_phone_account'').val());\n                              } else {\n                              session.set("xd_phone",$(''#p_phone'').val());\n                              }\n                              \n                              if ($(''#p_sms'').val() == '''') {\n                              session.set("firstSMSTime",''0'');\n                              }\n                              });\n        }\n        }\n        \n        function checkLogin_second() {\n        \n        //手机号和密码未就绪的\n        if (!window.xd_phone) return;\n        var cts = ''shop.10086.cn/i/?f=billdetailqry&welcome='';\n        if (window.location.href.indexOf(cts) >= 0) {\n        var phone = window.xd_phone;\n        //检测是否需要登陆短信\n        session.showProgress();\n        session.setProgressMax(7);\n        window.xd_progressMax = 1;\n        session.setProgress(window.xd_progressMax);\n        window.xd_data = new Object();\n        window.xd_month_progress_count = 0;\n        \n        setTimeout(function() {\n                   checkSec();\n                   },5000);\n        }\n        }\n        \n        function checkSec() {\n        if ($(''.all-site-loading div'').is('':visible'')) {\n        location.reload();\n        return;\n        }\n        \n        //检测是否需要二次验证\n        xd_check();\n        }\n        \n        function getMyUserInfo(phone) {\n        \n        var url = ''http://shop.10086.cn/i/v1/cust/info/'' + phone + ''?time='' + new Date().getTime();\n        $.get(url, function (result) {\n              \n              var data = result.data;\n              \n              var xd_user_info = {\n              ''mobile'':window.xd_phone,\n              ''name'': data.name,\n              ''household_address'': data.address,\n              ''contactNum'': data.contactNum,\n              ''registration_time'': data.inNetDate,\n              };\n              \n              window.xd_data[''user_info''] = xd_user_info;\n              window.xd_progressMax++;\n              session.setProgress(window.xd_progressMax);\n              window.xd_month_progress_count++;\n              xdProcessData();\n              });\n        }\n        \n        function spiderData() {\n        \n        //爬取用户信息\n        getMyUserInfo(window.xd_phone);\n        \n        //爬取用户通话详单\n        spiderData2();\n        }\n        \n        function spiderData2()  {\n        $(''#switch-data li'').eq(1).click();\n        $(''#month-data li'').eq(0).click();\n        \n        setTimeout(function() {\n                   if ($(''#switch-data li'').eq(1).attr(''class'') == ''active'') {\n                   startSpiderMonthData(0, 1);\n                   } else {\n                   spiderData2();\n                   }\n                   }, 3000);\n        }\n        \n        function checkDataRepetition() {\n        //标记上第一个，防止爬取重复\n        if ($(''#tbody'').xd_spider == undefined) {\n        // 新的，可以爬取\n        $(''#tbody'').xd_spider = true;\n        return true;\n        } else {\n        $(''#month-data li'').eq(month).click();\n        //查看是不是已经有此月份了\n        for (var i = 0; i < window.xd_callBill.length; i++) {\n        var obj = window.xd_callBill[i];\n        if (obj.calldate.indexOf(fixMonthValue) >= 0) {\n        //有此月份\n        window.xd_callBill.pop(obj);\n        break;\n        }\n        }\n        return false;\n        }\n        }\n        \n        function startSpiderMonthData(month, index) {\n        \n        // alert('''' + month + ''月 '' + index);\n        \n        var fixMonthValue = (function fixMonthValue(month) {\n                             var str = month;\n                             str=str.replace("年","");\n                             str=str.replace("月","");\n                             return str;\n                             })($(''#month-data li'').eq(month).text());\n        \n        //有详单记录\n        if ($(''#tbody'').is('':visible'')) {\n        log(''有详单记录'');\n        \n        var check = checkDataRepetition();\n        if (check == false) {\n        // 数据爬取重复\n        setTimeout(function () {\n                   startSpiderMonthData(month, 1);\n                   }, 3000);\n        return;\n        }\n        \n        //此月爬完push\n        var obj = new Object();\n        obj[''month''] = fixMonthValue;\n        obj[''value''] = get_current_page_bill();\n        var total = $(''#notes2'').text();\n        obj[''total''] = total.substring(1, total.length - 1);\n        pushCallDetailData(obj);\n        \n        var xd_page = $(''#notes1'').text().substring(1, $(''#notes1'').text().length - 1);\n        var xd_page1 = xd_page.substring(0, xd_page.indexOf(''/''));\n        var xd_page2 = xd_page.substring(xd_page.indexOf(''/'') + 1);\n        if (xd_page1 == xd_page2) {\n        log(''当前是最后一页'');\n        window.xd_progressMax++;\n        session.setProgress(window.xd_progressMax);\n        month++;\n        if (month > 5) {\n        window.xd_month_progress_count++;\n        xdProcessData();\n        return;\n        }\n        $(''#month-data li'').eq(month).click();\n        setTimeout(function () {\n                   startSpiderMonthData(month, index);\n                   }, 3000);\n        } else {\n        var nextIndex = parseInt(xd_page1);\n        nextIndex++;\n        window.jQuery(".gs-page").eq(nextIndex - 1).click();\n        setTimeout(function () {\n                   startSpiderMonthData(month, nextIndex);\n                   }, 4000);\n        }\n        return;\n        }\n        \n        //您选择时间段没有详单记录哦\n        if ($(''tbody.err tr td:eq(0) div:eq(0) div:eq(1) div:eq(0)'').is('':visible'')) {\n        log(''选择时间段没有详单记录'');\n        //此月爬完push\n        var obj = new Object();\n        obj[''month''] = fixMonthValue;\n        obj[''value''] = new Array();\n        obj[''total''] = 0;\n        pushCallDetailData(obj);\n        window.xd_progressMax = window.xd_progressMax + month + 1;\n        session.setProgress(window.xd_progressMax);\n        month++;\n        if (month > 5) {\n        window.xd_month_progress_count++;\n        xdProcessData();\n        return;\n        }\n        $(''#month-data li'').eq(month).click();\n        setTimeout(function () {\n                   startSpiderMonthData(month, index);\n                   }, 3000);\n        return;\n        }\n        \n        //还没出来，网络较差\n        if ($(''a.gs-search'').is('':visible'')) {\n        window.jQuery(".gs-page").eq(index - 1).click();\n        } else {\n        $(''#month-data li'').eq(month).click();\n        }\n        setTimeout(function () {\n                   startSpiderMonthData(month, index);\n                   }, 6000);\n        }\n        \n        function get_current_page_bill() {\n        var arr = new Array();\n        var page_total = $(''#tbody tr'').length;\n        for (var i = 0; i < page_total; i++) {\n        var wrapCall = new Object();\n        wrapCall[''callFee''] = $(''#tbody tr'').eq(i).find(''td'').eq(7).text();\n        wrapCall[''remoteType''] = $(''#tbody tr'').eq(i).find(''td'').eq(5).text();\n        wrapCall[''callType''] = $(''#tbody tr'').eq(i).find(''td'').eq(2).text();\n        wrapCall[''callTime''] = $(''#tbody tr'').eq(i).find(''td'').eq(4).text();\n        wrapCall[''callAddress''] = $(''#tbody tr'').eq(i).find(''td'').eq(1).text();\n        wrapCall[''callBeginTime''] = $(''#tbody tr'').eq(i).find(''td'').eq(0).text();\n        wrapCall[''otherNo''] = $(''#tbody tr'').eq(i).find(''td'').eq(3).text();\n        wrapCall[''taocan''] = $(''#tbody tr'').eq(i).find(''td'').eq(6).text();\n        arr.push(wrapCall);\n        }\n        return arr;\n        }\n        \n        //整理详单数据\n        function xdProcessData() {\n        if (window.xd_month_progress_count == 2) {\n        window.xd_data[''month_status''] = window.xd_callBill;\n        session.upload(window.xd_data);\n        session.finish();\n        }\n        }\n        \n        //存储详单数据\n        function pushCallDetailData(data) {\n        \n        if (!window.xd_callBill) {\n        window.xd_callBill = new Array();\n        }\n        \n        var monthData = null;\n        if (window.xd_callBill.length > 0) {\n        //查看是不是已经有此月份了\n        for (var i = 0; i < window.xd_callBill.length; i++) {\n        var obj = window.xd_callBill[i];\n        if (obj.calldate.indexOf(data.month) >= 0) {\n        //有此月份\n        monthData = obj;\n        break;\n        }\n        }\n        }\n        \n        //第一次添加月份\n        if (monthData == null) {\n        \n        var time = new Date().getTime();\n        var xd_cid = (function zfill(num, size) {\n                      var s = "000000000" + num;\n                      return s.substr(s.length - size);\n                      }(time, 10));\n        \n        monthData = new Object();\n        monthData[''data''] = new Array();\n        monthData[''calldate''] = data.month;\n        monthData[''totalCount''] = data.total;\n        monthData[''mobile''] = window.xd_phone;\n        monthData[''cid''] = xd_cid;\n        monthData[''status''] = 4;\n        window.xd_callBill.push(monthData);\n        }\n        \n        if (data.status){\n        monthData[''status''] = data.status;\n        }\n        \n        if (data.value.length > 0) {\n        for (var i = 0; i < data.value.length; i++) {\n        var call = data.value[i];\n        monthData.data.push(call);\n        }\n        }\n        }\n        \n        function xd_check() {\n        $(''#month-data li'').eq(0).click();\n        setTimeout(function() {\n                   if ($(''#show_vec_firstdiv'').is('':visible'')) {\n                   showMask(true);\n                   $(''#sendSmsBtn'').click(function () {\n                                          $(''#stc-send-sms'').click();\n                                          });\n                   return;\n                   }\n                   xd_check();\n                   }, 6000);\n        }\n        \n        function showMask(isShow) {\n        \n        if (!isShow) {\n        session.showProgress();\n        } else {\n        session.showProgress(false);\n        }\n        \n        if (isShow) {\n        if ($(''#maskDiv'').length == 0) {\n        \n        !function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=window;t["default"]=i.flex=function(e,t){var a=e||100,n=t||1,r=i.document,o=navigator.userAgent,d=o.match(/Android[\\S\\s]+AppleWebkit\\/(\\d{3})/i),l=o.match(/U3\\/((\\d+|\\.){5,})/i),c=l&&parseInt(l[1].split(".").join(""),10)>=80,p=navigator.appVersion.match(/(iphone|ipad|ipod)/gi),s=i.devicePixelRatio||1;p||d&&d[1]>534||c||(s=1);var u=1/s,m=r.querySelector(''meta[name="viewport"]'');m||(m=r.createElement("meta"),m.setAttribute("name","viewport"),r.head.appendChild(m)),m.setAttribute("content","width=device-width,user-scalable=no,initial-scale="+u+",maximum-scale="+u+",minimum-scale="+u),r.documentElement.style.fontSize=a/2*s*n+"px"},e.exports=t["default"]}]);  flex(200, 1);\n        \n        window.scrollTo(0,0);\n        \n        var leftGapFloat = .15;\n        var leftGap = leftGapFloat + ''rem'';\n        var webViewWidthFloat = screen.width / 100.;\n        var webViewWidth = webViewWidthFloat + ''rem'';\n        \n        var maskDiv = $(''<div></div>'');        //创建一个父div\n        maskDiv.attr(''id'', ''maskDiv'');        //给父div设置id\n        $("body").append(maskDiv);\n        $("#maskDiv").css({\n                          ''opacity'': 1,\n                          ''position'': ''absolute'',\n                          ''top'': 0,\n                          ''left'': 0,\n                          ''background-color'': ''#f0f1f3'',\n                          ''width'': $(document).width(),\n                          ''height'': $(document).height(),\n                          ''z-index'': 214748364,\n                          });\n        \n        // cell 背景\n        var cellBackgroundDiv = $(''<div><div/>'');\n        var cellStyle = {\n        ''position'': ''absolute'',\n        ''top'': ''.08rem'',\n        ''left'': ''0rem'',\n        ''width'': webViewWidth,\n        ''height'': ''1rem'',\n        ''background-color'': ''#ffffff'',\n        };\n        cellBackgroundDiv.css(cellStyle);\n        $("#maskDiv").append(cellBackgroundDiv);\n        \n        // cell 间隔线\n        var cellSeparator = $(''<div><div/>'');\n        cellSeparator.css({\n                          ''position'': ''absolute'',\n                          ''top'': ''.5rem'',\n                          ''left'': leftGap,\n                          ''width'': (webViewWidthFloat - leftGapFloat) + ''rem'',\n                          ''height'':''0.015rem'',\n                          ''background-color'': ''#e8e8e8'',\n                          });\n        cellBackgroundDiv.append(cellSeparator);\n        \n        //提示1\n        var title1 = $($(''<p><p/>''));\n        title1.text(''服务密码'');\n        title1.css({\n                   ''position'': ''absolute'',\n                   ''line-height'':''.5rem'',\n                   ''left'': leftGap,\n                   ''top'': 0,\n                   ''height'': ''.5rem'',\n                   ''width'': ''.8rem'',\n                   ''font-size'': ''.15rem'',\n                   });\n        cellBackgroundDiv.append(title1);\n        \n        var titleRightFloat = 0.95;\n        //密码输入框\n        var inputPwd = $(''<input type="text" id="inputPwd"/>'');\n        inputPwd.css({\n                     ''position'': ''absolute'',\n                     ''left'': titleRightFloat + ''rem'',\n                     ''top'': ''0rem'',\n                     ''height'': ''.5rem'',\n                     ''line-height'':''.5rem'',\n                     ''width'': webViewWidthFloat - titleRightFloat - leftGapFloat + ''rem'',\n                     ''font-size'': ''.15rem'',\n                     ''background-color'': ''white'',\n                     });\n        inputPwd.attr(''placeholder'', ''请输入服务密码'');\n        cellBackgroundDiv.append(inputPwd);\n        \n        //placeholder\n        \n        \n        //提示2\n        var title2 = $($(''<p><p/>''));\n        title2.text(''验证码'');\n        title2.css({\n                   ''position'': ''absolute'',\n                   ''line-height'':''.5rem'',\n                   ''left'': leftGap,\n                   ''top'': ''.5rem'',\n                   ''height'': ''.5rem'',\n                   ''width'': ''.8rem'',\n                   ''font-size'': ''.15rem'',\n                   });\n        cellBackgroundDiv.append(title2);\n        \n        //短信输入框\n        var inputSmsWidth = 320. / 750. * webViewWidthFloat;\n        var inputSms = $(''<input type="text" id="inputSms"/>'');\n        inputSms.css({\n                     ''position'': ''absolute'',\n                     ''left'': titleRightFloat + ''rem'',\n                     ''top'': ''.51rem'',\n                     ''height'': ''.49rem'',\n                     ''line-height'':''.49rem'',\n                     ''width'': inputSmsWidth + ''rem'',\n                     ''font-size'': ''.15rem'',\n                     ''background-color'': ''white'',\n                     });\n        inputSms.attr(''placeholder'', ''请输入短信验证码'');\n        cellBackgroundDiv.append(inputSms);\n        \n        //发送短信\n        var smssendwidthFloat = 194. / 750. * webViewWidthFloat;\n        var smssendwidth = smssendwidthFloat + ''rem'';\n        var input = $(''<input type="button" id="sendSmsBtn" value="获取短信"/>'');\n        input.click(settime);\n        input.css({\n                  ''position'': ''absolute'',\n                  ''border-radius'':''0.025rem'',\n                  ''left'': webViewWidthFloat - leftGapFloat - smssendwidthFloat + ''rem'',\n                  ''top'': ((.50 - .28) / 2 + .5) + ''rem'',\n                  ''height'': ''.28rem'',\n                  ''width'': smssendwidth,\n                  ''font-size'': ''.13rem'',\n                  ''color'': ''white'',\n                  ''background-color'':"#bcc0c9",\n                  });\n        cellBackgroundDiv.append(input);\n        \n        //错误提示\n        var errorMessage = $($(''<p id="xd_sec_errorMessage"><p/>''));\n        $("#maskDiv").append(errorMessage);\n        $(''#xd_sec_errorMessage'').css({\n                                      ''position'': ''absolute'',\n                                      ''left'': leftGap,\n                                      ''top'': 0.08 + 1 + ''rem'',\n                                      ''height'': ''.2rem'',\n                                      ''width'': ''3rem'',\n                                      ''line-height'':''.2rem'',\n                                      ''font-size'': ''0.1rem'',\n                                      ''color'': ''red'',\n                                      });\n        \n        //认证\n        var certificateBtn = $(''<input type="button" id="certificateBtn" value="去认证"/>'');\n        certificateBtn.click(certificateBtnAction);\n        $("#maskDiv").append(certificateBtn);\n        \n        $(''#certificateBtn'').css({\n                                 ''position'': ''absolute'',\n                                 ''border-radius'':''0.025rem'',\n                                 ''left'': leftGap,\n                                 ''top'': 0.08 + 1 + .2 + ''rem'',\n                                 ''height'': ''.5rem'',\n                                 ''width'': (webViewWidthFloat - leftGapFloat * 2) + ''rem'',\n                                 ''font-size'': ''.17rem'',\n                                 ''color'': ''white'',\n                                 ''background-color'':''#fe6246'',\n                                 });\n        \n        \n        } else {\n        $(''#maskDiv'').show();\n        }\n        } else {\n        if ($(''#maskDiv'').lensgth != 0) {\n        $(''#maskDiv'').hide();\n        }\n        }\n        }\n        \n        function certificateBtnAction() {\n        window.xd_pwd = $(''#inputPwd'').val();\n        \n        if (!/^\\d{6}$/.test(window.xd_pwd)) {\n        alert(''请输入6位服务密码！'');\n        return;\n        }\n        \n        if (!/^\\d{6}$/.test($(''#inputSms'').val())) {\n        alert(''请输入6位短信验证码！'');\n        return;\n        }\n        \n        //服务密码\n        $(''#vec_servpasswd'').val('''' + window.xd_pwd);\n        // 随机密码\n        $(''#vec_smspasswd'').val('''' + $(''#inputSms'').val());\n        \n        $(''#vecbtn'').click();\n        \n        $(''#certificateBtn'').attr({"disabled":true});\n        \n        setTimeout(function () {\n                   che_vertify_dismiss();\n                   }, 3000);\n        }\n        \n        window.countdown = 60;\n        function settime() {\n        \n        var obj = $(''#sendSmsBtn'')[0];\n        if (window.countdown == 0) {\n        obj.removeAttribute("disabled");\n        obj.value = "获取短信验证码";\n        window.countdown = 60;\n        return;\n        } else {\n        window.xd_pwd = $(''#inputPwd'').val();\n        obj.setAttribute("disabled", true);\n        obj.value = "重新发送(" + window.countdown + ")";\n        window.countdown--;\n        }\n        setTimeout(function () {\n                   settime();\n                   }\n                   , 1000);\n        }\n        \n        window.xd_sec_vertify_dis = 0;\n        function che_vertify_dismiss() {\n        window.xd_sec_vertify_dis++;\n        if (!$(''#show_vec_firstdiv'').is('':visible'') && $(''tbody'').length > 0) {\n        showMask();\n        $(''#switch-data li'').eq(1).click();\n        $(''#month-data li'').eq(0).click();\n        setTimeout(function () {\n                   window.xd_month_progress_count = 0;\n                   spiderData();\n                   }, 3000);\n        return;\n        }\n        \n        if ($(''#detailerrmsg'').is('':visible'')) {\n        //认证失败,提示错误信息\n        var errorMessage = $(''#detailerrmsg'').text();\n        $(''#xd_sec_errorMessage'').text(errorMessage);\n        $(''#certificateBtn'').removeAttr("disabled");\n        \n        } else {\n        if (window.xd_sec_vertify_dis == 6) {\n        window.xd_sec_vertify_dis = 0;\n        $(''#certificateBtn'').removeAttr("disabled");\n        return;\n        }\n        setTimeout(function() {che_vertify_dismiss();}, 3000);\n        }\n        }\n        \n        //设置当前页是登陆页\n        if ($(''#forget_btn'').length && $(''#forget_btn'').length > 0) {\n        session.setStartUrl();\n        }\n        });', 0, '2017-02-08 18:59:37', '2017-02-08 19:32:43');
INSERT INTO `scripts` (`id`, `spider_id`, `callCount`, `online`, `min_sdk`, `content`, `priority`, `created_at`, `updated_at`) VALUES
(13, 11, 0, 1, '1.0.0', 'log("****************Debug model *******************");\ndSpider("telecom_gd", function(session,env,$){\n    log("current page: "+location.href);\n\n\n    if(location.href.indexOf("gd.189.cn/TS/login.htm") != -1) {\n        session.setStartUrl();\n//        session.showProgress(false);\n        return;\n    } else if(location.href.indexOf("SSOLoginForCommNoPage") != -1) {\n        log("SSOLoginForCommNoPage");\n        return;\n    } else if(location.href.indexOf("http://gd.189.cn/TS/index.htm") != -1 || location.href.indexOf("gd.189.cn/TS/?SESSIONID=") != -1) {\n\n        session.showProgress();\n        session.setProgressMax(100);\n        session.autoLoadImg(false);\n        session.setProgress(0);\n        var thxd = session.get("thxd");\n        if(!thxd) {\n            thxd = {};\n        }\n        var userInfo = thxd.user_info;\n        if(!userInfo) {\n            userInfo = {};\n        }\n        if(!userInfo.name) {\n            var timeout = 10000;\n            var t = setInterval(function () {\n                timeout -= 10;\n                var ob = $("#user_name");\n                if (ob[0] && ob.text() != "--") {\n                    session.setProgress(10);\n                    clearInterval(t);\n                    userInfo.name = ob.text();\n                    log(JSON.stringify(userInfo));\n                    thxd.user_info = userInfo;\n                    session.set("thxd", thxd);\n                    location.href = "http://gd.189.cn/transaction/taocanapply1.jsp?operCode=ChangeCustInfoNew";\n                } else if (timeout === 0) {\n                    session.setProgress(10);\n                    clearInterval(t);\n                    location.href = "http://gd.189.cn/transaction/taocanapply1.jsp?operCode=ChangeCustInfoNew";\n                }\n            }, 10);\n        } else {\n            session.setProgress(10);\n            location.href = "http://gd.189.cn/transaction/taocanapply1.jsp?operCode=ChangeCustInfoNew";\n        }\n    } else if (location.href.indexOf("gd.189.cn/OperationInitAction2.do?OperCode=ChangeCustInfoNew") != -1) {\n\n        waitDomAvailable("#cust_name_id", function(dom,timeSpan) {\n            session.setProgress(20);\n            log("wait cust_name_id success");\n            var thxd = session.get("thxd");\n            if(!thxd) {\n                thxd = {};\n            }\n            var userInfo = thxd.user_info;\n            if(!userInfo) {\n                userInfo = {};\n            }\n            if(!userInfo.name) {\n                userInfo.name=$("#cust_name_id").val();\n            }\n\n            userInfo.idcard_no=$("#id_num_id").val();\n            userInfo.contactNum=$("#moblie_id").val();\n            var address = $("#post_addr_id").val();\n            if(address.length === 0) {\n                address = $("#id_addr_id").val();\n            }\n            userInfo.household_address = address;\n\n            thxd.user_info = userInfo;\n            session.set("thxd", thxd);\n\n            location.href = "http://gd.189.cn/TS/cx/puk_chaxun.htm?cssid=wdwt-xgcx-puk_pincx";\n            log(JSON.stringify(userInfo));\n        },function() {\n            session.setProgress(20);\n            log("wait cust_name_id fail");\n            location.href = "http://gd.189.cn/TS/cx/puk_chaxun.htm?cssid=wdwt-xgcx-puk_pincx";\n        });\n\n\n    } else if (location.href.indexOf("gd.189.cn/TS/cx/puk_chaxun.htm?cssid=wdwt-xgcx-puk_pincx") != -1) {\n\n        waitDomAvailable("#phone", function(dom,timeSpan) {\n            session.setProgress(30);\n            log("wait custName success");\n            var thxd = session.get("thxd");\n            if(!thxd) {\n                thxd = {};\n            }\n            var userInfo = thxd.user_info;\n            if(!userInfo) {\n                userInfo = {};\n            }\n\n            userInfo.mobile=$("#phone").text();\n\n            thxd.user_info = userInfo;\n            session.set("thxd", thxd);\n            log(JSON.stringify(userInfo));\n//                location.href="http://gd.189.cn/TS/wode-wangting-sec.htm?cssid=sy-dh-top-wdwt";\n            location.href="http://gd.189.cn/TS/cx/xiangdan_chaxun.htm?cssid=sy-kscx-xdcx";\n        },function() {\n            session.setProgress(30);\n            log("wait phone fail");\n            location.href="http://gd.189.cn/TS/cx/xiangdan_chaxun.htm?cssid=sy-kscx-xdcx";\n        });\n\n    } else if (location.href.indexOf("gd.189.cn/TS/cx/xiangdan_chaxun.htm?cssid=sy-kscx-xdcx") != -1) {\n        waitDomAvailable(".get_sms_code", function(dom,timeSpan) {\n            session.setProgress(40);\n            getLoginUserType();\n        },function() {\n            log("wait get_sms_code fail");\n            setXd([]);\n        });\n\n    }\n\n\n    var months = [];\n    var curMonthIndex = 0;\n    var phoneIndex = -1;\n    var dateIndex = -1;\n    var durationIndex = -1;\n    var feeIndex = -1;\n    var callTypeIndex = -1;\n    var locationIndex = -1;\n    var commuTypeIndex = -1;\n\n\n    var details=[];\n    var detail = {};\n    var datas=[];\n    var param={};\n\n    var loginUser={};\n\n    function loadXd() {\n\n        $.each($(".rq_list").find("li"), function () {\n            var month = {};\n            month.month = $(this).attr("data-month");\n            month.start = $(this).attr("data-start");\n            month.end = $(this).attr("data-end");\n            months.push(month);\n        });\n        log(JSON.stringify(months));\n        curMonthIndex = 0;\n\n        param={"d.d01":"","d.d02":"","d.d03":"","d.d04":"","d.d05":"20","d.d06":"1","d.d07":"","d.d08":"1"};\n        param["d.d06"]=1;\n        param["d.d01"]="call";\n        // param["d.d02"]=$(".rq_list_on").attr("data-month");\n        // param["d.d03"]=$(".rq_list_on").attr("data-start");\n        // param["d.d04"]=$(".rq_list_on").attr("data-end");\n        param["d.d02"]=months[curMonthIndex].month;\n        param["d.d03"]=months[curMonthIndex].start;\n        param["d.d04"]=months[curMonthIndex].end;\n        var SearchVerifyCode=$("#input_code").val().trim();\n        param["d.d07"]=SearchVerifyCode;\n\n\n        loadXdByMonth();\n    }\n\n    function loadXdByMonth() {\n        $.ajax({\n            url:"/J/J10009.j?a.c=0&a.u=user&a.p=pass&a.s=ECSS",\n            type:''get'',\n            dataType:"json",\n            data:param,\n            beforeSend:function(){\n                log("beforeSend");\n                log(param);\n            },\n            success:function(result){\n                log(param);\n                log(result);\n                if(result&&result.b&&result.b.c==="00"){//查询成功\n                    switch(result.r.code){\n                        case "000":\n                        case "009":\n                            result=result.r||result;\n                            var current_page=result.r06;\n                            var total_page=result.r05;\n                            if(current_page==1) {\n                                $.each(result.r02,function(i){\n                                    if(this.indexOf("通话类型") != -1) {\n                                        commuTypeIndex = i;\n                                    } else if(this.indexOf("号码") != -1) {\n                                        phoneIndex = i;\n                                    } else if(this.indexOf("日期") != -1) {\n                                        dateIndex = i;\n                                    } else if(this.indexOf("时长") != -1) {\n                                        durationIndex = i;\n                                    } else if(this.indexOf("费用") != -1) {\n                                        feeIndex = i;\n                                    } else if(this.indexOf("呼叫类型") != -1) {\n                                        callTypeIndex = i;\n                                    } else if(this.indexOf("通话地") != -1) {\n                                        locationIndex = i;\n                                    }\n                                });\n                            }\n                            $.each(result.r03,function(){\n                                var data = {};\n                                $.each(this, function (i) {\n                                    var s = this + "";\n                                    if (i == commuTypeIndex) {\n                                        data.remoteType = s;\n                                    } else if (i == phoneIndex) {\n                                        data.otherNo = s;\n                                    } else if (i == dateIndex) {\n                                        data.callBeginTime = s;\n                                    } else if (i == durationIndex) {\n                                        data.callTime = s;\n                                    } else if (i == feeIndex) {\n                                        data.callFee = s;\n                                    } else if (i == callTypeIndex) {\n                                        data.callType = s;\n                                    } else if (i == locationIndex) {\n                                        data.callAddress = s;\n                                    }\n                                });\n                                datas.push(data);\n                            });\n\n                            if(total_page>current_page) {\n                                param["d.d06"]=parseInt(param["d.d06"])+1;\n                                session.setProgress(45+(55/months.length)*(curMonthIndex+current_page/total_page));\n                                loadXdByMonth();\n                            } else {\n                                log("load success:" + months[curMonthIndex].month);\n                                detail = {};\n                                detail.calldate = months[curMonthIndex].month;\n                                detail.cid = parseInt(new Date().getTime()/1000).toString();\n                                detail.data = datas;\n                                detail.status = 4;\n                                details.push(detail);\n                                // log(JSON.stringify(datas)||''<tr><td class="empty">''+(result.msg||"暂无数据")+''</td></tr>'');\n                                datas = [];\n                                if(curMonthIndex < months.length-1) {\n                                    session.setProgress(45+55*(curMonthIndex+1)/months.length);\n                                    curMonthIndex++;\n                                    param["d.d02"]=months[curMonthIndex].month;\n                                    param["d.d03"]=months[curMonthIndex].start;\n                                    param["d.d04"]=months[curMonthIndex].end;\n                                    param["d.d06"]=1;\n                                    log("curMonthIndex:" + curMonthIndex + "|" + months[curMonthIndex].month);\n                                    loadXdByMonth();\n                                } else {\n                                    log("details");\n                                    log(JSON.stringify(details));\n                                    setXd(details);\n                                }\n                            }\n                            break;\n                        case "001"://未登录\n                            setTimeout(function(){\n                                location.href="https://gd.189.cn/TS/login.htm?redir="+encodeURIComponent(location.pathname+location.search);\n                            },1500);\n                            break;\n                        default://其它\n                            log(result.r.msg);\n                            if(result.r.msg.indexOf("验证码") != -1) {\n                                alert(result.r.msg);\n                                showMask(true);\n                            } else {\n//                                alert(result.r.msg);\n//                                location.href="https://gd.189.cn/TS/login.htm?redir="+encodeURIComponent(location.pathname+location.search);\n                                setXd([]);\n                            }\n                    }\n                }else{\n                    alert("清单查询初始化，请重试！");\n                    log("load fail:" + months[curMonthIndex].month);\n                    detail = {};\n                    detail.calldate = months[curMonthIndex].month;\n                    detail.cid = parseInt(new Date().getTime()/1000).toString();\n                    detail.data = datas;\n                    if(datas.length > 0) {\n                        detail.status = 5;\n                    } else {\n                        detail.status = 2;\n                    }\n                    details.push(detail);\n                    // log(JSON.stringify(datas)||''<tr><td class="empty">''+(result.msg||"暂无数据")+''</td></tr>'');\n                    datas = [];\n                    if(curMonthIndex < months.length-1) {\n                        session.setProgress(45+55*(curMonthIndex+1)/months.length);\n                        curMonthIndex++;\n                        param["d.d02"]=months[curMonthIndex].month;\n                        param["d.d03"]=months[curMonthIndex].start;\n                        param["d.d04"]=months[curMonthIndex].end;\n                        param["d.d06"]=1;\n                        log("curMonthIndex:" + curMonthIndex + "|" + months[curMonthIndex].month);\n                        loadXdByMonth();\n                    } else {\n                        log("details");\n                        log(JSON.stringify(details));\n                        setXd(details);\n                    }\n                }\n            },\n            error:function(err,textStatus){\n                log("ajax请求失败!readyState:"+err.readyState+",textStatus:"+textStatus);\n                alert("清单查询初始化，请重试！");\n\n                log("load error:" + months[curMonthIndex].month);\n                detail = {};\n                detail.calldate = months[curMonthIndex].month;\n                detail.cid = parseInt(new Date().getTime()/1000).toString();\n                detail.data = datas;\n                if(datas.length > 0) {\n                    detail.status = 5;\n                } else {\n                    detail.status = 2;\n                }\n                details.push(detail);\n                // log(JSON.stringify(datas)||''<tr><td class="empty">''+(result.msg||"暂无数据")+''</td></tr>'');\n                datas = [];\n                if(curMonthIndex < months.length-1) {\n                    session.setProgress(45+55*(curMonthIndex+1)/months.length);\n                    curMonthIndex++;\n                    param["d.d02"]=months[curMonthIndex].month;\n                    param["d.d03"]=months[curMonthIndex].start;\n                    param["d.d04"]=months[curMonthIndex].end;\n                    param["d.d06"]=1;\n                    log("curMonthIndex:" + curMonthIndex + "|" + months[curMonthIndex].month);\n                    loadXdByMonth();\n                } else {\n                    log("details");\n                    log(JSON.stringify(details));\n                    setXd(details);\n                }\n            },\n            complete:function(){\n                log("complete");\n            }\n        });\n    }\n\n    function setXd(xd) {\n        var thxd = session.get("thxd");\n        if(!thxd) {\n            thxd = {};\n        }\n        thxd.month_status = xd;\n        session.set("thxd", thxd);\n\n        session.setProgress(100);\n\n        log("爬取完毕----------" + JSON.stringify(thxd));\n        session.upload(JSON.stringify(thxd));\n        session.finish();\n    }\n\n\n    function getLoginUserType(){\n        $.ajax({\n            url:"/J/J10036.j?a.c=0&a.u=user&a.p=pass&a.s=ECSS",\n            type:''get'',\n            dataType:"json",\n            data:{},\n            beforeSend:function(){\n            },\n            success:function(result){\n                if(result&&result.b&&result.b.c==="00"){//查询成功\n                    switch(result.r.code){\n                        case "000":\n                            var r=result.r;\n                            loginUser.account= r.r03||r.r02;//当前号码\n                            loginUser.currNumBusiType = r.r05||r.r04;//当前号码业务类型\n                            loginUser.payType = r.r07;//付费类型\n                            loginUser.latnId= r.r14;//区号\n                            session.setProgress(45);\n                            // callback();\n                            log(JSON.stringify(loginUser));\n                            // getSmsCode(loginUser.latnId,loginUser.account);\n//                            showMask(true);\n                            xdInit();\n                            break;\n//                        case "001"://未登录\n                        default://其它\n                        if(confirm(result.r.msg)) {\n                            setXd([]);\n                        } else {\n                            setXd([]);\n                        }\n                        break;\n                    }\n                }else{\n                    setXd([]);\n                    log("详单查询初始化失败，请重试！");\n                }\n            },\n            error:function(err,textStatus){\n                setXd([]);\n                log("ajax请求失败!readyState:"+err.readyState+",textStatus:"+textStatus);\n            },\n            complete:function(){\n            }\n        });\n    }\n\n    /**\n     * 获得短信验证码\n     * @param lantId\n     * @param phone\n     */\n    function getSmsCode(){\n        log("getSmsCode:" + loginUser.latnId + "|" + loginUser.account);\n        $.ajax({\n            url:"/J/J20009.j?a.c=0&a.u=user&a.p=pass&a.s=ECSS",\n            type:''post'',\n            dataType:"json",\n            data:{"d.d01":loginUser.latnId,"d.d02":loginUser.account,"d.d03":"CDMA"},\n            success:function(result){\n                if(result&&result.b&&result.b.c==="00"){//查询成功\n                    var r=result.r;\n                    if(r.code==="000"){\n                        settime();\n                        log("短信验证码已经发送，请查收！");\n                        alert("短信验证码已经发送，请查收！");\n                    }else{\n                        log(msg);\n                        alert(msg);\n                    }\n                }else{\n                    log("短信验证码已经发送失败，请重试！");\n                    alert("短信验证码已经发送失败，请重试！");\n                }\n\n            },\n            error:function(err,textStatus){\n                log("ajax请求失败!readyState:"+err.readyState+",textStatus:"+textStatus);\n                alert("短信验证码已经发送失败，请重试！");\n            }\n        });\n    }\n\n\n\n\n    function showMask(isShow) {\n\n        if (!isShow) {\n            session.showProgress();\n        } else {\n            session.showProgress(false);\n\n        }\n\n        if (isShow) {\n            if ($(''#maskDiv'').length === 0) {\n                var maskDiv = $(''<div id="maskDiv" style="opacity: 1;position: absolute;top: 0;left: 0;background-color: white;width: 100%;height: 100%;z-index: 10000"></div>'');        //创建一个父div\n                $("body").append(maskDiv);\n                var button = $($(''<li class="input-row" style="display:-webkit-box;display: -webkit-flex"><span class="lf" style="display: block;width: 90px;height: 50px;line-height: 50px;margin-left: 15px;text-align: left;color: #3c3c3c;font-size: 18px">验证码</span><div style="-webkit-box-flex: 1;-webkit-flex: 1;flex: 1;display: -webkit-box;display: -webkit-flex;height: 50px"><p style="-webkit-box-flex: 1;-webkit-flex: 1;flex: 1;display: -webkit-box;display: -webkit-flex;height: 50px;"><input id="inputSms" style="width: 100%;height: 50px;border: none;font-size: 18px" placeholder="验证码"></p><span id="sendSmsBtn" style="display: block;width: 100px;height: 30px;line-height: 30px;background: #fe6246;color:white;font-size: 14px;margin-top: 10px;margin-right: 15px;text-align: center;border-radius: 6px">发送验证码</span></div></li><li style="display:-webkit-box;display: -webkit-flex;margin-top: 20px;margin-left: 15px;margin-right: 15px"><div style="-webkit-box-flex: 1;-webkit-flex: 1;flex: 1;display: -webkit-box;display: -webkit-flex;height: 50px"><span id="certificateBtn" style="width:100%;height:50px;line-height:50px;background:#fe6246;font-size:20px;color:white;text-align: center;border-radius: 6px">确定</span></div></li>''));\n                $("#maskDiv").append(button);\n                $(''#sendSmsBtn'').click(getSmsCode);\n                $(''#certificateBtn'').click(certificateBtnAction);\n            } else {\n                $(''#maskDiv'').show();\n            }\n        } else {\n            if ($(''#maskDiv'').length !== 0) {\n                $(''#maskDiv'').hide();\n            }\n        }\n    }\n\n    function certificateBtnAction() {\n        log(''certificateBtnAction'');\n\n        if (!/^\\d{6}$/.test($(''#inputSms'').val())) {\n            alert(''请输入6位短信验证码！'');\n            return;\n        }\n\n        showMask(false);\n\n        $("#input_code").val($(''#inputSms'').val());\n\n        loadXd();\n        // verify_second_sms($(''#inputSms'').val());\n    }\n\n    window.countdown = 60;\n    function settime() {\n        log("time:" + window.countdown);\n        var obj = $(''#sendSmsBtn'')[0];\n        if (window.countdown === 0) {\n            obj.removeAttribute("disabled");\n            $(''#sendSmsBtn'').text("发送验证码");\n            window.countdown = 60;\n            return;\n        } else {\n            window.xd_pwd = $(''#inputPwd'').val();\n            obj.setAttribute("disabled", true);\n            $(''#sendSmsBtn'').text("重新发送(" + window.countdown + ")");\n            window.countdown--;\n        }\n        setTimeout(function () {\n                settime();\n            } , 1000);\n    }\n\n    function xdInit() {\n        $.ajax({\n            url:"/J/J10008.j?a.c=0&a.u=user&a.p=pass&a.s=ECSS",\n            type:''get'',\n            dataType:"json",\n            beforeSend:function(){\n            },\n            success:function(result){\n                log("init:" + JSON.stringify(result));\n                if(result&&result.b&&result.b.c==="00"){//查询成功\n                    switch(result.r.code){\n                        case "000":\n                            showMask(true);\n                            break;\n//                        case "001"://未登录\n                        default://其它\n                            log("init:default");\n                            if(confirm(result.r.msg)) {\n                                setXd([]);\n                            } else {\n                                setXd([]);\n                            }\n//                            location.href="https://gd.189.cn/TS/login.htm?";\n                    }\n                }else if(result&&result.b&&result.b.v&&result.b.v=="999"){\n                    if(confirm(result.b.m)) {\n                        setXd([]);\n                    } else {\n                        setXd([]);\n                    }\n//                    location.href="https://gd.189.cn/TS/login.htm?";\n                }else{\n                    if(confirm("详单查询初始化失败，请重试！")) {\n                        setXd([]);\n                    } else {\n                        setXd([]);\n                    }\n//                    location.href="https://gd.189.cn/TS/login.htm?";\n                }\n            },\n            error:function(err,textStatus){\n                log("ajax请求失败!readyState:"+err.readyState+",textStatus:"+textStatus);\n                if(confirm("详单查询初始化失败，请重试！")) {\n                    setXd([]);\n                } else {\n                    setXd([]);\n                }\n//                location.href="https://gd.189.cn/TS/login.htm?";\n            },\n            complete:function(){\n            }\n        });\n    }\n\n});', 0, '2017-02-08 19:33:28', '2017-02-08 19:33:28'),
(16, 12, 16, 1, '1.0.0', '/**\n * Created by du on 16/11/21.\n */\nvar sessionKey=dQuery(".index_block h1").text()\ndSpider(sessionKey, function(session,env,$){\n    if(location.href.indexOf("/book/")!=-1){\n        $(".more a").text("爬取本书").css("background","#1ca72b");\n    }else if(/.+html\\/\\d+\\/\\d+\\/$/.test(location.href)) {\n        log(sessionKey)\n        var list = $(".chapter li a");\n        window.list = list\n        session.showProgress();\n        session.setProgressMax(list.length);\n        var curIndex = 0\n\n        function getText() {\n            var e = list.eq(curIndex);\n            $.get(e.attr("href")).done(function (data) {\n                var text = e.text() + "\\r\\n";\n                text += $(data).find("#txt").text()+"\\r\\n"\n                session.upload(text)\n\n            }).always(function () {\n                if (++curIndex < list.length) {\n                    session.setProgress(curIndex);\n                    session.setProgressMsg("正在爬取《"+sessionKey+"》 "+e.text())\n                    getText();\n                    log(curIndex, list.length)\n                } else {\n                    session.setProgress(curIndex);\n                    session.finish();\n                }\n            })\n        }\n        getText()\n    }\n})', 0, '2017-02-09 00:49:47', '2017-02-09 02:18:21');

-- --------------------------------------------------------

--
-- 表的结构 `spiders`
--

CREATE TABLE `spiders` (
  `id` int(10) UNSIGNED NOT NULL,
  `name` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `user_id` int(10) UNSIGNED NOT NULL DEFAULT '0',
  `description` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `readme` text COLLATE utf8_unicode_ci,
  `support` smallint(6) NOT NULL DEFAULT '7',
  `star` int(11) NOT NULL DEFAULT '0',
  `chargeType` smallint(6) NOT NULL DEFAULT '0',
  `freeLimits` int(11) NOT NULL DEFAULT '100',
  `price` double(8,2) NOT NULL DEFAULT '0.00',
  `defaultConfig` text COLLATE utf8_unicode_ci,
  `callCount` int(11) NOT NULL DEFAULT '0',
  `public` tinyint(1) NOT NULL DEFAULT '0',
  `access` int(11) NOT NULL DEFAULT '3',
  `startUrl` text COLLATE utf8_unicode_ci NOT NULL,
  `icon` varchar(100) COLLATE utf8_unicode_ci DEFAULT NULL,
  `category` smallint(6) NOT NULL DEFAULT '0',
  `ua` tinyint(4) NOT NULL DEFAULT '1',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

--
-- 转存表中的数据 `spiders`
--

INSERT INTO `spiders` (`id`, `name`, `user_id`, `description`, `readme`, `support`, `star`, `chargeType`, `freeLimits`, `price`, `defaultConfig`, `callCount`, `public`, `access`, `startUrl`, `icon`, `category`, `ua`, `created_at`, `updated_at`) VALUES
(1, 'hello word', 1, '测试脚本', '1. 此脚本为测试脚本，每个新建的应用都会默认拥有调用此脚本的权限\n2. 这是一个最简单的爬虫，启动后直接将数据传给sdk,然后结束掉本身。', 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://www.baidu.com', NULL, 0, 1, '2016-12-11 22:56:24', '2017-02-07 03:18:28'),
(2, '淘宝', 1, '获取用户淘宝信息、交易记录', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://login.m.taobao.com/login.htm', '9afeb89a029917362a5fd94cc56ade6f.png', 1, 3, '2016-12-11 22:56:24', '2017-02-06 00:04:40'),
(3, '京东', 1, '爬取用户京东信息、交易记录等信息。', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://www.baidu.com', 'df9cbcc7106fef0104963481fd1fc72b.png', 1, 1, '2016-12-11 22:56:24', '2017-02-05 22:57:01'),
(4, '支付宝', 1, '爬取支付宝信息、交易记录', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://custweb.alipay.com/account/index.htm', 'b782193bc2d9c53c1594a1f510a41473.png', 1, 1, '2016-12-11 22:56:24', '2017-02-05 23:14:38'),
(5, 'QQ邮箱', 1, '爬取qq邮箱中包含指定关键字的邮件', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://w.mail.qq.com/cgi-bin/loginpage?f=xhtml', '1fe29ef8206e131880eb969ca8e0857c.png', 2, 1, '2016-12-11 22:56:24', '2017-02-07 23:39:28'),
(6, '163邮箱', 1, '爬取163邮箱中包含指定关键字的邮件', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'http://172.19.23.62/dSpider-web/imp/email?t=163', '668f8d5b1ef7bf6f49620597d537c986.png', 2, 1, '2016-12-11 22:56:24', '2017-02-07 22:23:18'),
(7, '126邮箱', 1, '爬取126邮箱中包含指定关键字的邮件', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'http://smart.mail.126.com/', NULL, 2, 1, '2016-12-11 22:56:24', '2017-02-07 22:24:03'),
(8, '新浪邮箱', 1, '爬取sina(新浪)邮箱中包含指定关键字的邮件', NULL, 7, 0, 0, 100, 0.00, NULL, 7, 1, 3, 'http://mail.sina.cn/?vt=4', 'd987ca03790163d41ffe15528680e087.png', 2, 1, '2016-12-11 22:56:24', '2017-02-08 00:52:38'),
(9, '联通', 1, '爬取联通用户通话详单', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'http://wap.10010.com/t/query/getPhoneByDetailTip.htm', '9f8cfd57e4723ceb69fb4f153e519e2b.png', 1, 1, '2016-12-11 22:56:24', '2017-02-05 23:33:22'),
(10, '移动', 1, '爬取移动用户通话详单', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://login.10086.cn/login.html?channelID=12003&backUrl=http://shop.10086.cn/i/?f=billdetailqry', 'a2b9f9ab4e874fa50650174731c52c40.png', 1, 1, '2016-12-11 22:56:24', '2017-02-08 19:31:57'),
(11, '广东电信', 1, ' 爬取广东地区电信用户通话详单', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://gd.189.cn/TS/login.htm', 'a226bd2122baf1914f48a8ff0f06be68.png', 1, 1, '2016-12-11 22:56:24', '2017-02-05 23:38:24'),
(12, '顶点小说', 1, '爬取顶点小说网上的小说', NULL, 7, 0, 0, 100, 0.00, NULL, 20, 1, 3, 'http://m.23us.com/', 'e76d018a7c1608a5da28fb1c3c04b62e.jpeg', 3, 1, '2016-12-11 22:56:24', '2017-02-09 02:18:21'),
(13, '社保', 1, '爬取社保信息', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://www.baidu.com', '0c4af3952a1040a17c0532b9d3dbeb9c.png', 1, 1, '2016-12-11 22:56:24', '2017-02-05 23:52:15'),
(14, 'hello word', 1, '测试脚本', NULL, 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://www.baidu.com', NULL, 0, 1, '2016-12-11 22:56:24', '2017-02-05 23:53:10'),
(15, 'hello word', 1, '测试脚本', '1. 此脚本为测试脚本，每个新建的应用都会默认拥有调用此脚本的权限\r\n2. 这是一个最简单的爬虫，启动后直接将数据传给sdk,然后结束掉本身。', 7, 0, 0, 100, 0.00, NULL, 0, 1, 3, 'https://www.baidu.com', NULL, 0, 1, '2016-12-11 22:56:24', '2017-02-05 23:53:28');

-- --------------------------------------------------------

--
-- 表的结构 `spider_configs`
--

CREATE TABLE `spider_configs` (
  `id` int(10) UNSIGNED NOT NULL,
  `content` text COLLATE utf8_unicode_ci,
  `spider_id` int(10) UNSIGNED NOT NULL,
  `appKey_id` int(10) UNSIGNED NOT NULL,
  `callCount` int(11) NOT NULL DEFAULT '0',
  `online` tinyint(1) NOT NULL DEFAULT '1',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

--
-- 转存表中的数据 `spider_configs`
--

INSERT INTO `spider_configs` (`id`, `content`, `spider_id`, `appKey_id`, `callCount`, `online`, `created_at`, `updated_at`) VALUES
(1, NULL, 1, 1, 0, 1, '2016-12-19 23:20:19', '2017-02-07 03:18:28'),
(4, NULL, 1, 4, 0, 1, '2016-12-19 23:20:19', '2016-12-19 23:20:19'),
(5, NULL, 5, 1, 0, 1, '2017-02-07 02:24:04', '2017-02-07 23:39:28'),
(6, NULL, 6, 1, 0, 1, '2017-02-07 19:32:47', '2017-02-07 22:23:18'),
(7, NULL, 7, 1, 0, 1, '2017-02-07 22:02:12', '2017-02-07 22:24:03'),
(8, NULL, 8, 1, 7, 1, '2017-02-08 00:40:58', '2017-02-08 00:52:38'),
(10, NULL, 12, 1, 20, 1, '2017-02-09 00:48:50', '2017-02-09 02:18:21');

-- --------------------------------------------------------

--
-- 表的结构 `users`
--

CREATE TABLE `users` (
  `id` int(10) UNSIGNED NOT NULL,
  `name` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `email` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `password` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `remember_token` varchar(100) COLLATE utf8_unicode_ci DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

--
-- 转存表中的数据 `users`
--

INSERT INTO `users` (`id`, `name`, `email`, `password`, `remember_token`, `created_at`, `updated_at`) VALUES
(1, 'wendu', '824783146@qq.com', '$2y$10$yzVYVZ4j3yT365jXtLEJkO.KJtoG8oSNkyxcZPGjcFrhqiqAmiR2.', 'zxm5R3aZB5qdQQlIlGn0LBfOiFhcrtJCFK6wsxI0ZmQxCyZtbkxPuYT0rfA3', '2016-12-11 22:51:17', '2017-01-23 00:49:48');

--
-- Indexes for dumped tables
--

--
-- Indexes for table `app_keys`
--
ALTER TABLE `app_keys`
  ADD PRIMARY KEY (`id`),
  ADD KEY `app_keys_user_id_foreign` (`user_id`);

--
-- Indexes for table `crawl_records`
--
ALTER TABLE `crawl_records`
  ADD PRIMARY KEY (`id`),
  ADD KEY `crawl_records_appkey_id_foreign` (`appKey_id`),
  ADD KEY `crawl_records_spider_id_foreign` (`spider_id`),
  ADD KEY `crawl_records_device_id_foreign` (`device_id`);

--
-- Indexes for table `devices`
--
ALTER TABLE `devices`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `downloads`
--
ALTER TABLE `downloads`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `migrations`
--
ALTER TABLE `migrations`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `password_resets`
--
ALTER TABLE `password_resets`
  ADD KEY `password_resets_email_index` (`email`),
  ADD KEY `password_resets_token_index` (`token`);

--
-- Indexes for table `scripts`
--
ALTER TABLE `scripts`
  ADD PRIMARY KEY (`id`),
  ADD KEY `scripts_spider_id_foreign` (`spider_id`);

--
-- Indexes for table `spiders`
--
ALTER TABLE `spiders`
  ADD PRIMARY KEY (`id`),
  ADD KEY `spiders_user_id_foreign` (`user_id`);

--
-- Indexes for table `spider_configs`
--
ALTER TABLE `spider_configs`
  ADD PRIMARY KEY (`id`),
  ADD KEY `spider_configs_appkey_id_foreign` (`appKey_id`);

--
-- Indexes for table `users`
--
ALTER TABLE `users`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `users_email_unique` (`email`);

--
-- 在导出的表使用AUTO_INCREMENT
--

--
-- 使用表AUTO_INCREMENT `app_keys`
--
ALTER TABLE `app_keys`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=5;
--
-- 使用表AUTO_INCREMENT `crawl_records`
--
ALTER TABLE `crawl_records`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=29;
--
-- 使用表AUTO_INCREMENT `devices`
--
ALTER TABLE `devices`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;
--
-- 使用表AUTO_INCREMENT `downloads`
--
ALTER TABLE `downloads`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;
--
-- 使用表AUTO_INCREMENT `migrations`
--
ALTER TABLE `migrations`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=10;
--
-- 使用表AUTO_INCREMENT `scripts`
--
ALTER TABLE `scripts`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=17;
--
-- 使用表AUTO_INCREMENT `spiders`
--
ALTER TABLE `spiders`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=16;
--
-- 使用表AUTO_INCREMENT `spider_configs`
--
ALTER TABLE `spider_configs`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=11;
--
-- 使用表AUTO_INCREMENT `users`
--
ALTER TABLE `users`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=2;
--
-- 限制导出的表
--

--
-- 限制表 `app_keys`
--
ALTER TABLE `app_keys`
  ADD CONSTRAINT `app_keys_user_id_foreign` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE;

--
-- 限制表 `crawl_records`
--
ALTER TABLE `crawl_records`
  ADD CONSTRAINT `crawl_records_appkey_id_foreign` FOREIGN KEY (`appKey_id`) REFERENCES `app_keys` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `crawl_records_device_id_foreign` FOREIGN KEY (`device_id`) REFERENCES `devices` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `crawl_records_spider_id_foreign` FOREIGN KEY (`spider_id`) REFERENCES `spiders` (`id`) ON DELETE CASCADE;

--
-- 限制表 `scripts`
--
ALTER TABLE `scripts`
  ADD CONSTRAINT `scripts_spider_id_foreign` FOREIGN KEY (`spider_id`) REFERENCES `spiders` (`id`) ON DELETE CASCADE;

--
-- 限制表 `spiders`
--
ALTER TABLE `spiders`
  ADD CONSTRAINT `spiders_user_id_foreign` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE;

--
-- 限制表 `spider_configs`
--
ALTER TABLE `spider_configs`
  ADD CONSTRAINT `spider_configs_appkey_id_foreign` FOREIGN KEY (`appKey_id`) REFERENCES `app_keys` (`id`) ON DELETE CASCADE;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
